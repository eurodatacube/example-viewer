{"version":1,"kind":"Notebook","sha256":"8c2dfe876ed1e7d6f10c6b74286e3b73e819947802206c7f2a28f58c1de2323e","slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.eo-learn","location":"/external_notebooks/eurodatacube/notebooks/notebooks/curated/eo-learn.ipynb","dependencies":[],"frontmatter":{"title":"Using eo-learn in EDC: a starter’s guide.","content_includes_title":true,"kernelspec":{"name":"conda-env-users-edc-2023.10-01-py","display_name":"Python 3 (ipykernel)","language":"python"},"github":"https://github.com/eurodatacube/example-viewer","subject":"Euro Data Cube Examples","numbering":{"title":{"offset":5}},"edit_url":"https://github.com/eurodatacube/example-viewer/blob/main/external_notebooks/eurodatacube/notebooks/notebooks/curated/eo-learn.ipynb","thumbnail":"/example-viewer/build/5a1f8475f0c3652f4630d03d72891b98.png","exports":[{"format":"ipynb","filename":"eo-learn.ipynb","url":"/example-viewer/build/eo-learn-297713d071909c21623a4c78b0972f6c.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-10-24T07:57:54.524205Z","iopub.status.busy":"2023-10-24T07:57:54.523958Z","iopub.status.idle":"2023-10-24T07:57:54.567413Z","shell.execute_reply":"2023-10-24T07:57:54.566962Z"},"papermill":{"duration":0.07697,"end_time":"2023-10-24T07:57:54.568403","exception":false,"start_time":"2023-10-24T07:57:54.491433","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"from edc import check_compatibility\ncheck_compatibility(\"user-2023.10-01\", dependencies=[\"SH\"])","visibility":"show","key":"VRQZxuJdFf"},{"type":"output","id":"Wsqz4Q8i5lt73RMBduQF5","data":[{"output_type":"display_data","metadata":{},"data":{"text/html":{"content":"<script type=\"text/javascript\">\n        function toggle(id) {\n            el = document.getElementById(id);\n            el.style.display = el.style.display === \"none\" ? \"block\" : \"none\";\n        }\n    </script>","content_type":"text/html"},"text/plain":{"content":"<IPython.core.display.HTML object>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"text/html":{"content":"This notebook is compatible with this base image version (user-2023.10-01).","content_type":"text/html"},"text/plain":{"content":"<IPython.core.display.HTML object>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"text/markdown":{"content":"\n\n---------\n\nThe following environment variables are available:\n\n* `SH_CLIENT_ID`, `SH_INSTANCE_ID`, `SH_CLIENT_NAME`, `SH_CLIENT_SECRET`\n","content_type":"text/markdown"},"text/plain":{"content":"<IPython.core.display.Markdown object>","content_type":"text/plain"}}}],"visibility":"show","key":"tN6OHg0iax"}],"visibility":"show","key":"JAqWhmVq7K"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.024533,"end_time":"2023-10-24T07:57:54.637481","exception":false,"start_time":"2023-10-24T07:57:54.612948","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":1,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Using eo-learn in EDC: a starter’s guide.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"lXVIQ9IWaw"}],"identifier":"using-eo-learn-in-edc-a-starters-guide","label":"Using eo-learn in EDC: a starter’s guide.","html_id":"using-eo-learn-in-edc-a-starters-guide","implicit":true,"key":"CPE6bAMJS8"},{"type":"thematicBreak","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"oEb10wn1Tc"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Source: ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"z1cDeo7iF2"},{"type":"link","url":"https://eo-learn.readthedocs.io/en/latest/","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"eo-learn Python package documentation","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"PdAPOg74u5"}],"urlSource":"https://eo-learn.readthedocs.io/en/latest/","key":"qxu9Q9hHVP"}],"key":"fOVOiOBfJv"},{"type":"heading","depth":2,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Getting started with ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"WNMqxHLluu"},{"type":"inlineCode","value":"eo-learn","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"O1GVpCnqhC"}],"identifier":"getting-started-with-eo-learn","label":"Getting started with eo-learn","html_id":"getting-started-with-eo-learn","implicit":true,"key":"At7z86B9MX"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"strong","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"eo-learn","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"AjuGIAs3Ji"}],"key":"Ymb1uMwGMA"},{"type":"text","value":" is a collection of open source Python packages that have been developed to seamlessly access and process spatio-temporal image sequences acquired by any satellite fleet in a timely and automatic manner. eo-learn is easy to use, it’s design modular, and encourages collaboration – sharing and reusing of specific tasks in a typical EO-value-extraction workflows, such as cloud masking, image co-registration, feature extraction, classification, etc.","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"DHRnWKxURh"}],"key":"APtZJ7EuWb"},{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"eo-learn makes extraction of valuable information from satellite imagery as easy as defining a sequence of operations to be performed on satellite imagery. Image below illustrates a processing chain that maps water in satellite imagery by thresholding the Normalised Difference Water Index in user specified region of interest.","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"hKJB48f4lW"}],"key":"tjN3bu7Lgh"},{"type":"image","url":"/example-viewer/build/5a1f8475f0c3652f4630d03d72891b98.png","alt":"eo-learn workflow","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"m3gqvrjukj","urlSource":"https://eo-learn.readthedocs.io/en/latest/_images/eo-learn-illustration.png"},{"type":"paragraph","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"strong","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"eo-learn","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"ucUJDQBfMq"}],"key":"qCyPg2zxY4"},{"type":"text","value":" acts as a bridge between Earth observation/Remote sensing field and Python ecosystem for data science and machine learning. The library is written in Python and uses NumPy arrays to store and handle remote sensing data. Its aim is to make entry easier for non-experts to the field of remote sensing on one hand and bring the state-of-the-art tools for computer vision, machine learning, and deep learning existing in Python ecosystem to remote sensing experts.","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"GQU3HjgQ2E"}],"key":"BBibpPDl04"},{"type":"paragraph","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"strong","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"eo-learn","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"EOgsoGPFDo"}],"key":"Se06v7VGj7"},{"type":"text","value":" is divided into several subpackages according to different functionalities and external package dependencies. Therefore it is not necessary for user to install entire package but only the parts that he needs.","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"P0b0VNudoI"}],"key":"lh6fxYZAKP"},{"type":"paragraph","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"text","value":"At the moment there are the following subpackages:","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"bsDckxgiI0"}],"key":"oWYOWB8IVw"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":19,"column":1},"end":{"line":34,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":19,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"text","value":"eo-learn-core","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"g9zer9tUnt"}],"key":"pSPIamwJDd"},{"type":"text","value":" - The main subpackage which implements basic building blocks (EOPatch, EOTask and EOWorkflow) and commonly used functionalities.","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"Km1MKZ5wkP"}],"key":"xaWxPXxeDp"}],"key":"dZZO9l40y0"},{"type":"listItem","spread":true,"position":{"start":{"line":21,"column":1},"end":{"line":22,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"text","value":"eo-learn-coregistration","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"ulqzJ8giC6"}],"key":"y12JUMCbAm"},{"type":"text","value":" - The subpackage that deals with image co-registraion.","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"tePMEnuVlt"}],"key":"VCpRfbvV10"}],"key":"BN7SnBq7wW"},{"type":"listItem","spread":true,"position":{"start":{"line":23,"column":1},"end":{"line":24,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"text","value":"eo-learn-features","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"flP1uq9cmy"}],"key":"bKfZ7rW79N"},{"type":"text","value":" - A collection of utilities for extracting data properties and feature manipulation.","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"CW1mx8lstq"}],"key":"do7YhXt2ID"}],"key":"vGehMJZJEN"},{"type":"listItem","spread":true,"position":{"start":{"line":25,"column":1},"end":{"line":26,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"children":[{"type":"text","value":"eo-learn-geometry","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"lDHrzS5f4p"}],"key":"svWIpOmRmQ"},{"type":"text","value":" - Geometry subpackage used for geometric transformation and conversion between vector and raster data.","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"cBI5OZRaSc"}],"key":"oSJviLDVrL"}],"key":"vjJYJJi3vk"},{"type":"listItem","spread":true,"position":{"start":{"line":27,"column":1},"end":{"line":28,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"children":[{"type":"text","value":"eo-learn-io","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"key":"yy7bVesTCA"}],"key":"LQROZNRATl"},{"type":"text","value":" - Input/output subpackage that deals with obtaining data from Sentinel Hub services or saving and loading data locally.","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"key":"X7uhUxnCAi"}],"key":"o8Tk6oY9xP"}],"key":"ZX4DWOP5DF"},{"type":"listItem","spread":true,"position":{"start":{"line":29,"column":1},"end":{"line":30,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"children":[{"type":"text","value":"eo-learn-mask","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"key":"MpD3yvFnuT"}],"key":"CtibxxiD50"},{"type":"text","value":" - The subpackage used for masking of data and calculation of cloud masks.","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"key":"dmOWGTL0b0"}],"key":"N0H4ywA7KP"}],"key":"Hp8CyCZpnr"},{"type":"listItem","spread":true,"position":{"start":{"line":31,"column":1},"end":{"line":32,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"children":[{"type":"text","value":"eo-learn-ml-tools","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"key":"dcHb7s5zVg"}],"key":"I3OSS3fF9D"},{"type":"text","value":" - Various tools that can be used before or after the machine learning process.","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"key":"dV0ieriSqt"}],"key":"rlYqtnfsog"}],"key":"QDf1wQ0tuF"},{"type":"listItem","spread":true,"position":{"start":{"line":33,"column":1},"end":{"line":34,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"children":[{"type":"text","value":"eo-learn-visualization","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"key":"SLB2S7rQl8"}],"key":"MJVqcBdCig"},{"type":"text","value":" - Visualization tools for core elements of eo-learn.","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"key":"p50oTIsqF2"}],"key":"p9PuoZeOAs"}],"key":"ponV4ILTDb"}],"key":"WP87TTFINF"},{"type":"heading","depth":2,"position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"children":[{"type":"text","value":"Outline","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"key":"NJnZV02c19"}],"identifier":"outline","label":"Outline","html_id":"outline","implicit":true,"key":"MNV0TOOtSS"},{"type":"paragraph","position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"children":[{"type":"text","value":"In this demonstration Jupyter Notebook, based on the ","position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"key":"NPjxH8kOlN"},{"type":"link","url":"https://github.com/sentinel-hub/eo-learn/blob/master/examples/features/SpatioTemporalFeatures.ipynb","position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"children":[{"type":"text","value":"Spatio-Temporal Feature notebook","position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"key":"wvko3LMDdE"}],"urlSource":"https://github.com/sentinel-hub/eo-learn/blob/master/examples/features/SpatioTemporalFeatures.ipynb","data":{"kind":"file","org":"sentinel-hub","repo":"eo-learn","reference":"master","file":"examples/features/SpatioTemporalFeatures.ipynb","raw":"https://raw.githubusercontent.com/sentinel-hub/eo-learn/master/examples/features/SpatioTemporalFeatures.ipynb"},"internal":false,"protocol":"github","key":"JAkx3Zkskl"},{"type":"text","value":", we will learn how to:","position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"key":"oSt0QKmdoo"}],"key":"DI8Gcup6Is"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":39,"column":1},"end":{"line":46,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"children":[{"type":"crossReference","position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"children":[{"type":"text","value":"Create an ","position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"key":"zF7NItDmNq"},{"type":"inlineCode","value":"EOWorkflow","position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"key":"J71tsNvmCI"}],"identifier":"create-an-eoworkflow","label":"Create-an-EOWorkflow","kind":"heading","template":"{name}","resolved":true,"html_id":"create-an-eoworkflow","key":"KothlujMRi"}],"key":"DRI2h6U26w"},{"type":"listItem","spread":true,"position":{"start":{"line":40,"column":1},"end":{"line":45,"column":1}},"children":[{"type":"crossReference","position":{"start":{"line":40,"column":1},"end":{"line":40,"column":1}},"children":[{"type":"text","value":"Visualize the ","position":{"start":{"line":40,"column":1},"end":{"line":40,"column":1}},"key":"ex4zez6b1u"},{"type":"inlineCode","value":"EOPatch","position":{"start":{"line":40,"column":1},"end":{"line":40,"column":1}},"key":"TcZtdUrznP"},{"type":"text","value":" output from the ","position":{"start":{"line":40,"column":1},"end":{"line":40,"column":1}},"key":"ZFN1DKoC7x"},{"type":"inlineCode","value":"EOWorkflow","position":{"start":{"line":40,"column":1},"end":{"line":40,"column":1}},"key":"T7tZaxkhNa"}],"identifier":"visualize-the-eopatch-output-from-the-eoworkflow","label":"Visualize-the-EOPatch-output-from-the-EOWorkflow","kind":"heading","template":"{name}","resolved":true,"html_id":"visualize-the-eopatch-output-from-the-eoworkflow","key":"WwNwEHkavF"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":41,"column":1},"end":{"line":45,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":41,"column":1},"end":{"line":41,"column":1}},"children":[{"type":"link","url":"#VALID_DATA-mask","position":{"start":{"line":41,"column":1},"end":{"line":41,"column":1}},"children":[{"type":"inlineCode","value":"VALID_DATA","position":{"start":{"line":41,"column":1},"end":{"line":41,"column":1}},"key":"WN3NDDbR7a"},{"type":"text","value":" mask","position":{"start":{"line":41,"column":1},"end":{"line":41,"column":1}},"key":"KjeIsXLkux"}],"urlSource":"#VALID_DATA-mask","key":"Zkz3Hv6zqV"}],"key":"KY5Otxe4ZN"},{"type":"listItem","spread":true,"position":{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},"children":[{"type":"crossReference","position":{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},"children":[{"type":"text","value":"Cloud cover","position":{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},"key":"m1fPoJJFML"}],"identifier":"cloud-cover","label":"Cloud-cover","kind":"heading","template":"{name}","resolved":true,"html_id":"cloud-cover","key":"tOvHous9PZ"}],"key":"Ib1pMyPYPy"},{"type":"listItem","spread":true,"position":{"start":{"line":43,"column":1},"end":{"line":43,"column":1}},"children":[{"type":"crossReference","position":{"start":{"line":43,"column":1},"end":{"line":43,"column":1}},"children":[{"type":"text","value":"Spatiotemporal features of a specific field","position":{"start":{"line":43,"column":1},"end":{"line":43,"column":1}},"key":"S9YFqYdhMU"}],"identifier":"spatiotemporal-features-of-a-specific-field","label":"Spatiotemporal-features-of-a-specific-field","kind":"heading","template":"{name}","resolved":true,"html_id":"spatiotemporal-features-of-a-specific-field","key":"SPk8Wvtk9J"}],"key":"Z9UHOc64XL"},{"type":"listItem","spread":true,"position":{"start":{"line":44,"column":1},"end":{"line":44,"column":1}},"children":[{"type":"crossReference","position":{"start":{"line":44,"column":1},"end":{"line":44,"column":1}},"children":[{"type":"text","value":"Distribution of temporal indices","position":{"start":{"line":44,"column":1},"end":{"line":44,"column":1}},"key":"UQdzbUgClO"}],"identifier":"distribution-of-temporal-indices","label":"Distribution-of-temporal-indices","kind":"heading","template":"{name}","resolved":true,"html_id":"distribution-of-temporal-indices","key":"JBXCTbkUq9"}],"key":"T1gkxPYdna"},{"type":"listItem","spread":true,"position":{"start":{"line":45,"column":1},"end":{"line":45,"column":1}},"children":[{"type":"crossReference","position":{"start":{"line":45,"column":1},"end":{"line":45,"column":1}},"children":[{"type":"text","value":"False color images of NDVI features","position":{"start":{"line":45,"column":1},"end":{"line":45,"column":1}},"key":"Rmi6oFQ4Jb"}],"identifier":"false-color-images-of-ndvi-features","label":"False-color-images-of-NDVI-features","kind":"heading","template":"{name}","resolved":true,"html_id":"false-color-images-of-ndvi-features","key":"laSEWu09ta"}],"key":"b7JhU3f9u9"}],"key":"MyhXDLFby5"}],"key":"wll4CB1UMn"},{"type":"listItem","spread":true,"position":{"start":{"line":46,"column":1},"end":{"line":46,"column":1}},"children":[{"type":"crossReference","position":{"start":{"line":46,"column":1},"end":{"line":46,"column":1}},"children":[{"type":"text","value":"Load an existing ","position":{"start":{"line":46,"column":1},"end":{"line":46,"column":1}},"key":"Tu1nhVE8rf"},{"type":"inlineCode","value":"EOPatch","position":{"start":{"line":46,"column":1},"end":{"line":46,"column":1}},"key":"Kuidl5vN6T"},{"type":"text","value":" from a filesystem to build another ","position":{"start":{"line":46,"column":1},"end":{"line":46,"column":1}},"key":"JXf7kaKejL"},{"type":"inlineCode","value":"EOWorkflow","position":{"start":{"line":46,"column":1},"end":{"line":46,"column":1}},"key":"gYNkKWwoyL"}],"identifier":"load-an-existing-eopatch-from-a-filesystem-to-build-another-eoworkflow","label":"Load-an-existing-EOPatch-from-a-filesystem-to-build-another-EOWorkflow","kind":"heading","template":"{name}","resolved":true,"html_id":"load-an-existing-eopatch-from-a-filesystem-to-build-another-eoworkflow","key":"ryko9Juz3l"}],"key":"H6uzqNMs3F"}],"key":"xq2OTfMR1u"}],"visibility":"show","key":"A1CebGEtmm"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.024016,"end_time":"2023-10-24T07:57:54.700066","exception":false,"start_time":"2023-10-24T07:57:54.676050","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Prerequisites","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"tooigCI15Q"}],"identifier":"prerequisites","label":"Prerequisites","html_id":"prerequisites","implicit":true,"key":"RtzNSxM7Vy"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Before starting to build our own processing chain for Earth Observation (EO) data, we need to import necessary Python libraries (already configured in your EDC workplace) and generate credentials automatically to access the services.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"CtqFuRKPwl"}],"key":"LjWR3Q41QU"}],"visibility":"show","key":"VydCMXB3IL"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-10-24T07:57:54.766377Z","iopub.status.busy":"2023-10-24T07:57:54.765940Z","iopub.status.idle":"2023-10-24T07:57:57.257913Z","shell.execute_reply":"2023-10-24T07:57:57.257435Z"},"papermill":{"duration":2.518331,"end_time":"2023-10-24T07:57:57.259363","exception":false,"start_time":"2023-10-24T07:57:54.741032","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# EDC libraries\n# from edc import setup_environment_variables\n\n# Utilities\nimport os\nimport warnings\nimport itertools as it\nimport numpy as np\nimport matplotlib.pyplot as plt\nfrom datetime import timedelta\nfrom matplotlib.colors import ListedColormap, BoundaryNorm\nfrom mpl_toolkits.axes_grid1 import make_axes_locatable\n\n# eo-learn\nfrom eolearn.core import (LoadTask, SaveTask, EONode, EOWorkflow, FeatureType, EOPatch, \n                          EOTask, ZipFeatureTask, OutputTask)\nfrom eolearn.io import SentinelHubInputTask\nfrom eolearn.features.ndi import NormalizedDifferenceIndexTask\nfrom eolearn.features.extra.interpolation import LinearInterpolationTask\n\n# Sentinel Hub\nfrom sentinelhub import BBox, CRS, DataCollection, SHConfig","visibility":"show","key":"UuHs9Fx8lA"},{"type":"output","id":"couF5NsP4BKznYahJyvNj","data":[],"visibility":"show","key":"b8WdhWXdiB"}],"visibility":"show","key":"Sq6X9IY22c"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-10-24T07:57:57.323982Z","iopub.status.busy":"2023-10-24T07:57:57.323386Z","iopub.status.idle":"2023-10-24T07:57:57.326225Z","shell.execute_reply":"2023-10-24T07:57:57.325810Z"},"papermill":{"duration":0.029351,"end_time":"2023-10-24T07:57:57.327195","exception":false,"start_time":"2023-10-24T07:57:57.297844","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# Supress warnings for a neater notebook\nwarnings.filterwarnings(\"ignore\")","visibility":"show","key":"m74t7gCiqT"},{"type":"output","id":"vtIN7RLO1ZtB5sAqweImp","data":[],"visibility":"show","key":"l91qTKw10t"}],"visibility":"show","key":"a2GtfWtLYS"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-10-24T07:57:57.397343Z","iopub.status.busy":"2023-10-24T07:57:57.396996Z","iopub.status.idle":"2023-10-24T07:57:57.403598Z","shell.execute_reply":"2023-10-24T07:57:57.403213Z"},"papermill":{"duration":0.038037,"end_time":"2023-10-24T07:57:57.404674","exception":false,"start_time":"2023-10-24T07:57:57.366637","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# Add plot to the Jupyter Notebook\n%matplotlib inline","visibility":"show","key":"akc15RLmpU"},{"type":"output","id":"bFtuqjYpHg0-t-KGV28cn","data":[],"visibility":"show","key":"mMNYycYyYM"}],"visibility":"show","key":"xQ8X6FPVUi"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.025713,"end_time":"2023-10-24T07:57:57.471525","exception":false,"start_time":"2023-10-24T07:57:57.445812","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Define required EOTask","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"i7R7WwQfPo"}],"identifier":"define-required-eotask","label":"Define required EOTask","html_id":"define-required-eotask","implicit":true,"key":"e3FFpqLKTu"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"In the following cell, we will create self-defined EOTasks which will be used in this example.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Yg12NzLC8C"}],"key":"s5Ih1mBvZN"}],"visibility":"show","key":"vDvRewmV2l"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-10-24T07:57:57.533411Z","iopub.status.busy":"2023-10-24T07:57:57.533139Z","iopub.status.idle":"2023-10-24T07:57:57.547112Z","shell.execute_reply":"2023-10-24T07:57:57.546627Z"},"papermill":{"duration":0.039137,"end_time":"2023-10-24T07:57:57.548207","exception":false,"start_time":"2023-10-24T07:57:57.509070","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# Define a task using ZipFeatureTask\nclass AddValidDataMaskTask(ZipFeatureTask):\n    def zip_method(self, *mask):\n        return np.logical_and(\n            mask[0].astype(bool), # 0 to False and 1 to True\n            np.logical_not((mask[1] != 0).astype(bool)) # CLM==1 or CLM==255 (clouds and no data) to False CLM==0 (clear) to True\n        )\n\nclass AddSpatioTemporalFeaturesTask(EOTask):\n    \"\"\"Task that implements and adds to eopatch the spatio-temporal features proposed in [1].\n\n    This task assumes that the argmax/argmin of NDVI, NDVI slope and B4 are present in eopatch. The computed\n    spatio-temporal features correspond to the concatenation of reflectance (green, red, near-infrared and short-wave\n    infrared in [1]) values taken at dates where:\n\n    1) NDVI is maximum\n    2) NDVI is minimum\n    3) red reflectances are maximum\n    4) NDVI slope is maximum\n    5) NDVI slope is minimum\n\n    The features are added to the `data_timeless` attribute dictionary of eopatch.\n\n    [1] Waldner et al. \"Automated annual cropland mapping using knowledge-based temporal features\", ISPRS Journal of\n    Photogrammetry and Remote Sensing, 2015\n\n    \"\"\"\n\n    def __init__(\n        self,\n        argmax_ndvi=\"ARGMAX_NDVI\",\n        argmin_ndvi=\"ARGMIN_NDVI\",\n        argmax_red=\"ARGMAX_B4\",\n        argmax_ndvi_slope=\"ARGMAX_NDVI_SLOPE\",\n        argmin_ndvi_slope=\"ARGMIN_NDVI_SLOPE\",\n        feats_feature=\"STF\",\n        data_feature=\"BANDS-S2-L1C\",\n        indices=None,\n    ):\n        \"\"\"Class constructor\n\n        Initialisation of task variables. The name of the dictionary keys that will be used for the computation of the\n        features needs to be specified. These features are assumed to be existing in the eopatch. The indices of the\n        reflectances to be used as features is an input parameter. If `None` is used, the data attribute is supposed to\n        have 13 bands and indices for green/red/infrared/short-wave-infrared are used.\n\n        :param argmax_ndvi: Name of `argmax_ndvi` feature in eopatch. Default is `'ARGMAX_NDVI'`\n        :param argmin_ndvi: Name of `argmin_ndvi` feature in eopatch. Default is `'ARGMIN_NDVI'`\n        :param argmax_red: Name of `argmax_red` feature in eopatch. Default is `'ARGMAX_B4'`\n        :param argmax_ndvi_slope: Name of `argmax_ndvi_slope` feature in eopatch. Default is `'ARGMAX_NDVI_SLOPE'`\n        :param argmin_ndvi_slope: Name of `argmin_ndvi_slope` feature in eopatch. Default is `'ARGMIN_NDVI_SLOPE'`\n        :param feats_feature: Name of feature containing spatio-temporal features. Default is `'STF'`\n        :param data_feature: Name of feature containing the reflectances to be used as features. Default is\n            `'BANDS-S2-L1C'`\n        :param indices: List of indices from `data_feature` to be used as features. Default is `None`, corresponding to\n            [2, 3, 7, 11] indices\n        \"\"\"\n        self.argmax_ndvi = argmax_ndvi\n        self.argmin_ndvi = argmin_ndvi\n        self.argmax_red = argmax_red\n        self.argmax_ndvi_slope = argmax_ndvi_slope\n        self.argmin_ndvi_slope = argmin_ndvi_slope\n        self.feats_feature = feats_feature\n        self.data_feature = data_feature\n        if indices is None:\n            indices = [2, 3, 7, 11]\n        self.indices = indices\n\n    def execute(self, eopatch: EOPatch) -> EOPatch:\n        \"\"\"Compute spatio-temporal features for input eopatch\n\n        :param eopatch: Input eopatch\n        :return: eopatch with computed spatio-temporal features\n        \"\"\"\n        # pylint: disable=invalid-name\n        amax_ndvi, amin_ndvi = eopatch.data_timeless[self.argmax_ndvi], eopatch.data_timeless[self.argmin_ndvi]\n        amax_ndvi_slope = eopatch.data_timeless[self.argmax_ndvi_slope]\n        amin_ndvi_slope = eopatch.data_timeless[self.argmin_ndvi_slope]\n        amax_red = eopatch.data_timeless[self.argmax_red]\n\n        stf_idx = [amax_ndvi, amin_ndvi, amax_ndvi_slope, amin_ndvi_slope, amax_red]\n\n        bands = eopatch.data[self.data_feature][..., self.indices]\n\n        _, h, w, _ = bands.shape\n        hh, ww = np.ogrid[:h, :w]\n        stf = np.concatenate([bands[ii.squeeze(), hh, ww] for ii in stf_idx if ii is not None], axis=-1)\n\n        eopatch.data_timeless[self.feats_feature] = stf\n\n        return eopatch\n\n\nclass AddMaxMinTemporalIndicesTask(EOTask):\n    \"\"\"Task to compute temporal indices of the maximum and minimum of a data feature\n\n    This class computes the `argmax` and `argmin` of a data feature in the input eopatch (e.g. NDVI, B4). The data\n    can be masked out by setting the `mask_data` flag to `True`. In that case, the `'VALID_DATA'` mask feature is\n    used for masking. If `mask_data` is `False`, the data is masked using the `'IS_DATA'` feature.\n\n    Two new features are added to the `data_timeless` attribute.\n    \"\"\"\n\n    def __init__(\n        self,\n        data_feature=\"NDVI\",\n        data_index=None,\n        amax_data_feature=\"ARGMAX_NDVI\",\n        amin_data_feature=\"ARGMIN_NDVI\",\n        mask_data=True,\n    ):\n        \"\"\"Task constructor\n\n        :param data_feature: Name of the feature in data used for computation of max/min. Default is `'NDVI'`\n        :param data_index: Index of to be extracted from last dimension in `data_feature`. If None, last dimension of\n            data array is assumed ot be of size 1 (e.g. as in NDVI). Default is `None`\n        :param amax_data_feature: Name of feature to be associated to computed feature of argmax values\n        :param amin_data_feature: Name of feature to be associated to computed feature of argmin values\n        :param mask_data: Flag specifying whether to mask data with `'VALID_DATA'` mask. If `False`, the `'IS_DATA'`\n            mask is used\n        \"\"\"\n        self.data_feature = data_feature\n        self.data_index = data_index\n        self.mask_data = mask_data\n        self.amax_feature = amax_data_feature\n        self.amin_feature = amin_data_feature\n\n    def execute(self, eopatch: EOPatch) -> EOPatch:\n        \"\"\"Compute argmax/argmin of specified `data_feature` and `data_index`\n\n        :param eopatch: Input eopatch\n        :return: eopatch with added argmax/argmin features\n        \"\"\"\n        valid_data_mask = eopatch.mask[\"VALID_DATA\"] if self.mask_data else eopatch.mask[\"IS_DATA\"]\n\n        data = (\n            eopatch.data[self.data_feature]\n            if self.data_index is None\n            else eopatch.data[self.data_feature][..., self.data_index][..., np.newaxis]\n        )\n\n        madata = np.ma.array(data, dtype=np.float32, mask=np.logical_or(~valid_data_mask.astype(bool), np.isnan(data)))\n\n        argmax_data = np.ma.MaskedArray.argmax(madata, axis=0)\n        argmin_data = np.ma.MaskedArray.argmin(madata, axis=0)\n\n        if argmax_data.ndim == 2:\n            argmax_data = argmax_data.reshape(argmax_data.shape + (1,))\n\n        if argmin_data.ndim == 2:\n            argmin_data = argmin_data.reshape(argmin_data.shape + (1,))\n\n        eopatch.data_timeless[self.amax_feature] = argmax_data\n        eopatch.data_timeless[self.amin_feature] = argmin_data\n\n        return eopatch\n\n\nclass AddMaxMinNDVISlopeIndicesTask(EOTask):\n    \"\"\"Task to compute the argmax and argmin of the NDVI slope\n\n    This task computes the slope of the NDVI feature using central differences. The NDVI feature can be masked using the\n    `'VALID_DATA'` mask. Current implementation loops through every location of eopatch, and is therefore slow.\n\n    The NDVI slope at date t is computed as $(NDVI_{t+1}-NDVI_{t-1})/(date_{t+1}-date_{t-1})$.\n    \"\"\"\n\n    def __init__(\n        self,\n        data_feature=\"NDVI\",\n        argmax_feature=\"ARGMAX_NDVI_SLOPE\",\n        argmin_feature=\"ARGMIN_NDVI_SLOPE\",\n        mask_data=True,\n    ):\n        \"\"\"Task constructor\n\n        :param data_feature: Name of data feature with NDVI values. Default is `'NDVI'`\n        :param argmax_feature: Name of feature with computed argmax values of the NDVI slope\n        :param argmin_feature: Name of feature with computed argmin values of the NDVI slope\n        :param mask_data: Flag for masking NDVI data. Default is `True`\n        \"\"\"\n        self.data_feature = data_feature\n        self.argmax_feature = argmax_feature\n        self.argmin_feature = argmin_feature\n        self.mask_data = mask_data\n\n    def execute(self, eopatch: EOPatch) -> EOPatch:\n        \"\"\"Computation of NDVI slope using finite central differences\n\n        This implementation loops through every spatial location, considers the valid NDVI values and approximates their\n        first order derivative using central differences. The argument of min and max is added to the eopatch.\n\n        The NDVI slope at date t is computed as $(NDVI_{t+1}-NDVI_{t-1})/(date_{t+1}-date_{t-1})$.\n\n        :param eopatch: Input eopatch\n        :return: eopatch with NDVI slope argmin/argmax features\n        \"\"\"\n        # pylint: disable=invalid-name\n        if self.mask_data:\n            valid_data_mask = eopatch.mask[\"VALID_DATA\"]\n        else:\n            valid_data_mask = eopatch.mask[\"IS_DATA\"]\n\n        ndvi = np.ma.array(eopatch.data[self.data_feature], dtype=np.float32, mask=~valid_data_mask.astype(bool))\n\n        all_dates = np.asarray([x.toordinal() for x in eopatch.timestamps])\n\n        if ndvi.ndim == 4:\n            h, w = ndvi.shape[1:3]\n        else:\n            raise ValueError(f\"{self.data_feature} feature has incorrect number of dimensions\")\n\n        argmax_ndvi_slope, argmin_ndvi_slope = np.zeros((h, w, 1), dtype=np.uint8), np.zeros((h, w, 1), dtype=np.uint8)\n\n        for ih, iw in it.product(range(h), range(w)):\n            ndvi_curve = ndvi[:, ih, iw, :]\n            valid_idx = np.where(~ndvi.mask[:, ih, iw])[0]\n\n            ndvi_curve = ndvi_curve[valid_idx]\n            valid_dates = all_dates[valid_idx]\n\n            ndvi_slope = np.convolve(ndvi_curve.squeeze(), [1, 0, -1], \"valid\") / np.convolve(\n                valid_dates, [1, 0, -1], \"valid\"\n            )\n\n            # +1 to compensate for the 'valid' convolution which eliminates first and last\n            argmax_ndvi_slope[ih, iw] = valid_idx[np.argmax(ndvi_slope) + 1]\n            argmin_ndvi_slope[ih, iw] = valid_idx[np.argmin(ndvi_slope) + 1]\n\n            del ndvi_curve, valid_idx, valid_dates, ndvi_slope\n\n        eopatch.data_timeless[self.argmax_feature] = argmax_ndvi_slope\n        eopatch.data_timeless[self.argmin_feature] = argmin_ndvi_slope\n\n        return eopatch","visibility":"show","key":"GRZdkOPN9n"},{"type":"output","id":"I9iaouv_Z2JYkxf1XoQBi","data":[],"visibility":"show","key":"iEGwupFojm"}],"visibility":"show","key":"NL8U9xaTzO"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.036518,"end_time":"2023-10-24T07:57:57.623943","exception":false,"start_time":"2023-10-24T07:57:57.587425","status":"completed"},"tags":[]},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Quick tip:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"zLe2OVZYKe"}],"key":"p3E86copLP"}],"key":"SmqM7TnBIJ"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"inlineCode","value":"SentinelHubInputTask()","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"AiE9XFvz50"},{"type":"text","value":", ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"LQWO4vk8rB"},{"type":"inlineCode","value":"NormalizedDifferenceIndexTask()","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"WWaXTP4p5k"},{"type":"text","value":", ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"wWm11aA2wI"},{"type":"inlineCode","value":"AddMaxMinTemporalIndicesTask()","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"S1IpIHMt9V"},{"type":"text","value":", ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"gOpFm8jNe4"},{"type":"inlineCode","value":"AddMaxMinTemporalIndicesTask()","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"I2yOHegs2p"},{"type":"text","value":", ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"DesjJvfph9"},{"type":"inlineCode","value":"AddMaxMinNDVISlopeIndicesTask()","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"pIUuVRxFMN"},{"type":"text","value":", ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"z5F4wyLswm"},{"type":"inlineCode","value":"AddSpatioTemporalFeaturesTask()","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"JFJohNVIJz"},{"type":"text","value":", ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"W3cFxGwwJ7"},{"type":"inlineCode","value":"SaveTask()","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"dT03qxJdKN"},{"type":"text","value":", ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"uPZbfH9O16"},{"type":"inlineCode","value":"OutputTask","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"wE9vQxZCjW"},{"type":"text","value":" are self-defined EOTasks performing the tasks listed above. You can also defined your own ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Q4oL6FpBRE"},{"type":"inlineCode","value":"EOTask","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"R2bmzY4LUZ"},{"type":"text","value":" as shown below:","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"SXyYpbWlsm"}],"key":"KZy1CuSo6b"},{"type":"code","lang":"python","value":"class FooTask(EOTask):\n    def __init__(self, foo_param):\n        self.foo_param = foo_param\n        \n    def execute(self, eopatch, *, patch_specific_param):\n        # do what foo does on input eopatch and return it\n        return eopatch","position":{"start":{"line":4,"column":1},"end":{"line":12,"column":1}},"key":"i24pTRawwD"},{"type":"paragraph","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"For more detail and other pre-defined functions please refer to our ","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"imwARwxZM1"},{"type":"inlineCode","value":"eo-learn","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"sQqyeRfFh1"},{"type":"text","value":" ","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"APeydelcWO"},{"type":"link","url":"https://eo-learn.readthedocs.io/en/latest/eolearn.html","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"documentation","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"RZsR71DjPF"}],"urlSource":"https://eo-learn.readthedocs.io/en/latest/eolearn.html","key":"uTwMYFTV1c"},{"type":"text","value":".","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"gz26FN3933"}],"key":"zDxwtieZhD"}],"visibility":"show","key":"ghBSFngclP"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.023888,"end_time":"2023-10-24T07:57:57.685025","exception":false,"start_time":"2023-10-24T07:57:57.661137","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Credentials","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Xsdw2dJSBG"}],"identifier":"credentials","label":"Credentials","html_id":"credentials","implicit":true,"key":"CrJPe22mLb"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Credentials for Sentinel Hub services are automatically injected as environement variables. It is therefore easy to populate Sentinel Hub’s credential manager with the values.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"KIlrbm7cyN"}],"key":"ezIhusy7ob"}],"visibility":"show","key":"C0tIglTxIp"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-10-24T07:57:57.747068Z","iopub.status.busy":"2023-10-24T07:57:57.746658Z","iopub.status.idle":"2023-10-24T07:57:57.750141Z","shell.execute_reply":"2023-10-24T07:57:57.749658Z"},"papermill":{"duration":0.029485,"end_time":"2023-10-24T07:57:57.751198","exception":false,"start_time":"2023-10-24T07:57:57.721713","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# Pass Sentinel Hub credentials to SHConfig\nconfig = SHConfig()\nconfig.sh_client_id = os.environ[\"SH_CLIENT_ID\"]\nconfig.sh_client_secret = os.environ[\"SH_CLIENT_SECRET\"]","visibility":"show","key":"InIKJQDlAg"},{"type":"output","id":"buCJm2nfAocvjbhFLqSo5","data":[],"visibility":"show","key":"QjqbW5cuZr"}],"visibility":"show","key":"SjNl720sNT"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.024316,"end_time":"2023-10-24T07:57:57.815965","exception":false,"start_time":"2023-10-24T07:57:57.791649","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Create an ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"LtOSf8LZzo"},{"type":"inlineCode","value":"EOWorkflow","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"mXoJ7CIT0I"}],"identifier":"create-an-eoworkflow","label":"Create an EOWorkflow","html_id":"create-an-eoworkflow","implicit":true,"key":"HCxV6TMRTF"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"In the following cell, we will create an ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"oMJbf5gIHL"},{"type":"inlineCode","value":"EOWorkflow","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"aWf5qZaJig"},{"type":"text","value":" implementing the spatiotemporal features proposed by ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"YI4eReStE4"},{"type":"emphasis","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Waldner et al., 2015","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"xVmcd2Qq6b"}],"key":"uHZ0S2ip1J"},{"type":"text","value":" [1].","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"nnLbevFNOB"}],"key":"kSwW9hDhBT"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"The workflow consists of:","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"JIbjZN9FnJ"}],"key":"L9ZOXbU0BW"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":6,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"a task to download Sentinel-2 data","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"WdV63dLy8b"}],"key":"MQshvwUtI3"},{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"a task to calculate NDVI","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"SAJtjCxYhd"}],"key":"OzONJgo8lD"},{"type":"listItem","spread":true,"position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"a task to generate valid data mask","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"bSWC26tNdA"}],"key":"ytwSwblgtv"},{"type":"listItem","spread":true,"position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"a task to compute the argmax and argmin of NDVI","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"GHqfGMyPtx"}],"key":"rgSTjKIpjr"},{"type":"listItem","spread":true,"position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"a task to compute the argmax and argmin of the red band","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"G9sRvlFluX"}],"key":"W2m16ajy8y"},{"type":"listItem","spread":true,"position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"a task to compute the argmax and argmin of NDVI slope","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"o0WRBUmKMK"}],"key":"xNAqvfGnzZ"},{"type":"listItem","spread":true,"position":{"start":{"line":12,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"text","value":"a task to compute spatiotemporal features correspond to the concatenation of reflectance (green, red, NIR and SWIR) values taken at dates where:","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"SaV1cuJJCh"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":13,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"NDVI is maximum","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"B7Zq8X8wQP"}],"key":"dwpl8YI0n2"},{"type":"listItem","spread":true,"position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"text","value":"NDVI is minimum","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"p2RFzXMfgM"}],"key":"Kc7wVrc4Qm"},{"type":"listItem","spread":true,"position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"red reflectance are maximum","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"Wqj7rn6LDb"}],"key":"REgbNadKME"},{"type":"listItem","spread":true,"position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"text","value":"NDVI slope is maximum","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"ca1LALGWV9"}],"key":"rHegOJskBm"},{"type":"listItem","spread":true,"position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"text","value":"NDVI slope is minimum","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"uyQBk2wCY4"}],"key":"MQAhD3FFfI"}],"key":"ixO0tmSLPR"}],"key":"QRt33wG9cy"},{"type":"listItem","spread":true,"position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"text","value":"a task to save the given ","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"Nl76h9F1Pd"},{"type":"inlineCode","value":"EOPatch","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"zaBXr9SQxG"},{"type":"text","value":" to a filesystem","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"MWyHhnxIr7"}],"key":"ug3hJ7HxQL"},{"type":"listItem","spread":true,"position":{"start":{"line":19,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"text","value":"a task to keep the eo-patch in memory after the completion of the workflow","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"UWKPLDzpTV"}],"key":"Yd2vI88JnB"}],"key":"CK4ZGQ15ZC"},{"type":"paragraph","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"text","value":"After each task is defined as an ","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"PIAKmU0zZm"},{"type":"inlineCode","value":"EOTask","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"v5hzmPgLy5"},{"type":"text","value":", we can wrap ","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"rR7SgBusrJ"},{"type":"inlineCode","value":"EOTasks","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"TsVxQbmlbW"},{"type":"text","value":" into ","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"b9J1aKjqHt"},{"type":"inlineCode","value":"EONodes","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"Tdnwaeng4B"},{"type":"text","value":" and assemble all ","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"ilmD4rHWcJ"},{"type":"inlineCode","value":"EONodes","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"fZCzqJ8KTT"},{"type":"text","value":" to form an ","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"FXEBVUTuT8"},{"type":"inlineCode","value":"EOWorkflow","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"JCYg2iPUMP"},{"type":"text","value":" ready to be executed.","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"hT0CVVw58Z"}],"key":"ZwoK7l38Hj"},{"type":"paragraph","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"text","value":"[1] Waldner et al. “Automated Annual Cropland Mapping Using Knowledge-based Temporal Features”, 2015 ISPRS Journal of Photogrammetrz and Remote Sensing.","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"bkrICDQBWC"}],"key":"goX5ULGHXJ"}],"visibility":"show","key":"va7NNP2XNP"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-10-24T07:57:57.878432Z","iopub.status.busy":"2023-10-24T07:57:57.878198Z","iopub.status.idle":"2023-10-24T07:57:57.884439Z","shell.execute_reply":"2023-10-24T07:57:57.883932Z"},"papermill":{"duration":0.032034,"end_time":"2023-10-24T07:57:57.885591","exception":false,"start_time":"2023-10-24T07:57:57.853557","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# Define `EOTasks`\nadd_data_task = SentinelHubInputTask(\n    data_collection = DataCollection.SENTINEL2_L1C, \n    bands_feature=(FeatureType.DATA, 'BANDS-S2-L1C'),\n    time_difference = timedelta(hours=2),\n    resolution=20,\n    additional_data = [\n        (FeatureType.MASK, 'CLM'),\n        (FeatureType.MASK, 'dataMask', 'IS_DATA'), # assigning 'dataMask' band to 'IS_DATA'\n    ],\n    config=config\n)\n\nndvi_task = NormalizedDifferenceIndexTask(\n    input_feature=(FeatureType.DATA, 'BANDS-S2-L1C'),\n    output_feature=(FeatureType.DATA, 'NDVI'),\n    bands = [7,2]    \n)\n\nadd_valmask = AddValidDataMaskTask({FeatureType.MASK: ['IS_DATA', 'CLM']}, (FeatureType.MASK, 'VALID_DATA'))\n\nadd_maxmin_ndvi = AddMaxMinTemporalIndicesTask(mask_data=True)\n\nadd_maxmin_red = AddMaxMinTemporalIndicesTask(data_feature='BANDS-S2-L1C', \n                                              data_index=3, \n                                              amax_data_feature='ARGMAX_B4',\n                                              amin_data_feature='ARGMIN_B4',\n                                              mask_data=True)\n\nadd_maxmin_ndvi_sl = AddMaxMinNDVISlopeIndicesTask()\n\nadd_stf = AddSpatioTemporalFeaturesTask()\n\nsave_task = SaveTask('./stf', overwrite_permission=1, compress_level=0)\n\noutput_task = OutputTask(\"eopatch\")","visibility":"show","key":"lewY3mDB25"},{"type":"output","id":"axBk6kz2enieR0BrderUj","data":[],"visibility":"show","key":"josKXaQBge"}],"visibility":"show","key":"FoY9glaAps"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.02219,"end_time":"2023-10-24T07:57:57.945260","exception":false,"start_time":"2023-10-24T07:57:57.923070","status":"completed"},"tags":[]},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Next, we can wrap ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"g9euZJGDaq"},{"type":"inlineCode","value":"EOTasks","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"YrblCzjUCH"},{"type":"text","value":" into ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"HxUJrQeZ81"},{"type":"inlineCode","value":"EONode","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ayBAWLTfuq"},{"type":"text","value":", join all the ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"aNcCx6KHHZ"},{"type":"inlineCode","value":"EONodes","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"E7EkmqzGX2"},{"type":"text","value":" together into an acyclic executable ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"A73rNjuoJs"},{"type":"inlineCode","value":"EOWorkflow","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"pjNp9lrzeX"},{"type":"text","value":", and visualize it with ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"yDVtVjOarx"},{"type":"inlineCode","value":"dependency_graph()","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"piswUY9AKj"},{"type":"text","value":" function. Below demonstrates the most comprehensive way to build a ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"gdEeAe7fZG"},{"type":"inlineCode","value":"EOWorkflow","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"mo60Vtdpft"},{"type":"text","value":". Other simplified methods can be found in the ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"BeStwi1631"},{"type":"link","url":"https://eo-learn.readthedocs.io/en/latest/examples/core/CoreOverview.html#EONode-and-EOWorkflow","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"documentation","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"izuA3RCCn8"}],"urlSource":"https://eo-learn.readthedocs.io/en/latest/examples/core/CoreOverview.html#EONode-and-EOWorkflow","key":"lxEaQlpONK"},{"type":"text","value":".","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"q17eqi7pKU"}],"key":"er0kwi31fH"}],"visibility":"show","key":"cq7b7Zz8x1"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-10-24T07:57:58.009319Z","iopub.status.busy":"2023-10-24T07:57:58.008885Z","iopub.status.idle":"2023-10-24T07:57:58.135577Z","shell.execute_reply":"2023-10-24T07:57:58.135145Z"},"papermill":{"duration":0.153463,"end_time":"2023-10-24T07:57:58.136817","exception":false,"start_time":"2023-10-24T07:57:57.983354","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# Wrap `EOTasks` into `EONode`\nadd_data_node = EONode(add_data_task, inputs=[], name=\"Sentinel Hub Input Task\")\nndvi_node = EONode(ndvi_task, inputs=[add_data_node], name=\"Compute NDVI Task\")\nadd_valmask_node = EONode(add_valmask, inputs=[ndvi_node], name=\"Add Valid Mask Task\")\nadd_maxmin_ndvi_node = EONode(add_maxmin_ndvi, inputs=[add_valmask_node], name=\"Add MaxMin NDVI Task\")\nadd_maxmin_red_node = EONode(add_maxmin_red, inputs=[add_maxmin_ndvi_node], name=\"Add ArgMaxMin Red Task\")\nadd_maxmin_ndvi_sl_node = EONode(add_maxmin_ndvi_sl, inputs=[add_maxmin_red_node], name=\"Add MaxMin NDVI Slope Task\")\nadd_stf_node = EONode(add_stf, inputs=[add_maxmin_ndvi_sl_node], name=\"Add Spatiotemporal Features Task\")\nsave_task_node = EONode(save_task, inputs=[add_stf_node], name=\"Save Task\")\noutput_node = EONode(output_task, inputs=[save_task_node], name=\"Output EOPatch\")\n\n# Assemble `EOTasks` to an `EOWorkflow`\nworkflow = EOWorkflow(\n    [\n        add_data_node,\n        ndvi_node,\n        add_valmask_node,\n        add_maxmin_ndvi_node,\n        add_maxmin_red_node,\n        add_maxmin_ndvi_sl_node,\n        add_stf_node,\n        save_task_node,\n        output_node\n    ]\n)\n\n\n# Visualize the `EOWorkflow`\nworkflow.dependency_graph()","visibility":"show","key":"PjjbKgDNwL"},{"type":"output","id":"2yGOy2w5FZ7tXVVX08jYV","data":[{"output_type":"execute_result","execution_count":8,"metadata":{},"data":{"image/svg+xml":{"content":"<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"no\"?>\n<!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 1.1//EN\"\n \"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\">\n<!-- Generated by graphviz version 8.0.3 (20230418.1244)\n -->\n<!-- Pages: 1 -->\n<svg width=\"2401pt\" height=\"44pt\"\n viewBox=\"0.00 0.00 2400.51 44.00\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\">\n<g id=\"graph0\" class=\"graph\" transform=\"scale(1 1) rotate(0) translate(4 40)\">\n<polygon fill=\"white\" stroke=\"none\" points=\"-4,4 -4,-40 2396.51,-40 2396.51,4 -4,4\"/>\n<!-- Sentinel Hub Input Task -->\n<g id=\"node1\" class=\"node\">\n<title>Sentinel Hub Input Task</title>\n<ellipse fill=\"none\" stroke=\"black\" cx=\"123.49\" cy=\"-18\" rx=\"123.48\" ry=\"18\"/>\n<text text-anchor=\"middle\" x=\"123.49\" y=\"-14.3\" font-family=\"Times,serif\" font-size=\"14.00\">Sentinel Hub Input Task</text>\n</g>\n<!-- Compute NDVI Task -->\n<g id=\"node2\" class=\"node\">\n<title>Compute NDVI Task</title>\n<ellipse fill=\"none\" stroke=\"black\" cx=\"387.62\" cy=\"-18\" rx=\"104.78\" ry=\"18\"/>\n<text text-anchor=\"middle\" x=\"387.62\" y=\"-14.3\" font-family=\"Times,serif\" font-size=\"14.00\">Compute NDVI Task</text>\n</g>\n<!-- Sentinel Hub Input Task&#45;&gt;Compute NDVI Task -->\n<g id=\"edge1\" class=\"edge\">\n<title>Sentinel Hub Input Task&#45;&gt;Compute NDVI Task</title>\n<path fill=\"none\" stroke=\"black\" d=\"M247.11,-18C255.36,-18 263.65,-18 271.85,-18\"/>\n<polygon fill=\"black\" stroke=\"black\" points=\"271.58,-21.5 281.58,-18 271.58,-14.5 271.58,-21.5\"/>\n</g>\n<!-- Add Valid Mask Task -->\n<g id=\"node3\" class=\"node\">\n<title>Add Valid Mask Task</title>\n<ellipse fill=\"none\" stroke=\"black\" cx=\"634.85\" cy=\"-18\" rx=\"106.68\" ry=\"18\"/>\n<text text-anchor=\"middle\" x=\"634.85\" y=\"-14.3\" font-family=\"Times,serif\" font-size=\"14.00\">Add Valid Mask Task</text>\n</g>\n<!-- Compute NDVI Task&#45;&gt;Add Valid Mask Task -->\n<g id=\"edge2\" class=\"edge\">\n<title>Compute NDVI Task&#45;&gt;Add Valid Mask Task</title>\n<path fill=\"none\" stroke=\"black\" d=\"M492.62,-18C500.61,-18 508.7,-18 516.77,-18\"/>\n<polygon fill=\"black\" stroke=\"black\" points=\"516.73,-21.5 526.73,-18 516.73,-14.5 516.73,-21.5\"/>\n</g>\n<!-- Add MaxMin NDVI Task -->\n<g id=\"node4\" class=\"node\">\n<title>Add MaxMin NDVI Task</title>\n<ellipse fill=\"none\" stroke=\"black\" cx=\"898.98\" cy=\"-18\" rx=\"121.58\" ry=\"18\"/>\n<text text-anchor=\"middle\" x=\"898.98\" y=\"-14.3\" font-family=\"Times,serif\" font-size=\"14.00\">Add MaxMin NDVI Task</text>\n</g>\n<!-- Add Valid Mask Task&#45;&gt;Add MaxMin NDVI Task -->\n<g id=\"edge3\" class=\"edge\">\n<title>Add Valid Mask Task&#45;&gt;Add MaxMin NDVI Task</title>\n<path fill=\"none\" stroke=\"black\" d=\"M741.71,-18C749.81,-18 758.05,-18 766.29,-18\"/>\n<polygon fill=\"black\" stroke=\"black\" points=\"766.11,-21.5 776.11,-18 766.11,-14.5 766.11,-21.5\"/>\n</g>\n<!-- Add ArgMaxMin Red Task -->\n<g id=\"node5\" class=\"node\">\n<title>Add ArgMaxMin Red Task</title>\n<ellipse fill=\"none\" stroke=\"black\" cx=\"1187.81\" cy=\"-18\" rx=\"131.08\" ry=\"18\"/>\n<text text-anchor=\"middle\" x=\"1187.81\" y=\"-14.3\" font-family=\"Times,serif\" font-size=\"14.00\">Add ArgMaxMin Red Task</text>\n</g>\n<!-- Add MaxMin NDVI Task&#45;&gt;Add ArgMaxMin Red Task -->\n<g id=\"edge4\" class=\"edge\">\n<title>Add MaxMin NDVI Task&#45;&gt;Add ArgMaxMin Red Task</title>\n<path fill=\"none\" stroke=\"black\" d=\"M1020.79,-18C1028.99,-18 1037.28,-18 1045.57,-18\"/>\n<polygon fill=\"black\" stroke=\"black\" points=\"1045.45,-21.5 1055.45,-18 1045.45,-14.5 1045.45,-21.5\"/>\n</g>\n<!-- Add MaxMin NDVI Slope Task -->\n<g id=\"node6\" class=\"node\">\n<title>Add MaxMin NDVI Slope Task</title>\n<ellipse fill=\"none\" stroke=\"black\" cx=\"1505.23\" cy=\"-18\" rx=\"150.27\" ry=\"18\"/>\n<text text-anchor=\"middle\" x=\"1505.23\" y=\"-14.3\" font-family=\"Times,serif\" font-size=\"14.00\">Add MaxMin NDVI Slope Task</text>\n</g>\n<!-- Add ArgMaxMin Red Task&#45;&gt;Add MaxMin NDVI Slope Task -->\n<g id=\"edge5\" class=\"edge\">\n<title>Add ArgMaxMin Red Task&#45;&gt;Add MaxMin NDVI Slope Task</title>\n<path fill=\"none\" stroke=\"black\" d=\"M1319.38,-18C1327.45,-18 1335.62,-18 1343.8,-18\"/>\n<polygon fill=\"black\" stroke=\"black\" points=\"1343.55,-21.5 1353.55,-18 1343.55,-14.5 1343.55,-21.5\"/>\n</g>\n<!-- Add Spatiotemporal Features Task -->\n<g id=\"node7\" class=\"node\">\n<title>Add Spatiotemporal Features Task</title>\n<ellipse fill=\"none\" stroke=\"black\" cx=\"1862.3\" cy=\"-18\" rx=\"170.87\" ry=\"18\"/>\n<text text-anchor=\"middle\" x=\"1862.3\" y=\"-14.3\" font-family=\"Times,serif\" font-size=\"14.00\">Add Spatiotemporal Features Task</text>\n</g>\n<!-- Add MaxMin NDVI Slope Task&#45;&gt;Add Spatiotemporal Features Task -->\n<g id=\"edge6\" class=\"edge\">\n<title>Add MaxMin NDVI Slope Task&#45;&gt;Add Spatiotemporal Features Task</title>\n<path fill=\"none\" stroke=\"black\" d=\"M1655.79,-18C1663.89,-18 1672.07,-18 1680.27,-18\"/>\n<polygon fill=\"black\" stroke=\"black\" points=\"1680.04,-21.5 1690.04,-18 1680.04,-14.5 1680.04,-21.5\"/>\n</g>\n<!-- Save Task -->\n<g id=\"node8\" class=\"node\">\n<title>Save Task</title>\n<ellipse fill=\"none\" stroke=\"black\" cx=\"2126.43\" cy=\"-18\" rx=\"57.39\" ry=\"18\"/>\n<text text-anchor=\"middle\" x=\"2126.43\" y=\"-14.3\" font-family=\"Times,serif\" font-size=\"14.00\">Save Task</text>\n</g>\n<!-- Add Spatiotemporal Features Task&#45;&gt;Save Task -->\n<g id=\"edge7\" class=\"edge\">\n<title>Add Spatiotemporal Features Task&#45;&gt;Save Task</title>\n<path fill=\"none\" stroke=\"black\" d=\"M2033.39,-18C2041.85,-18 2050.08,-18 2057.91,-18\"/>\n<polygon fill=\"black\" stroke=\"black\" points=\"2057.7,-21.5 2067.7,-18 2057.7,-14.5 2057.7,-21.5\"/>\n</g>\n<!-- Output EOPatch -->\n<g id=\"node9\" class=\"node\">\n<title>Output EOPatch</title>\n<ellipse fill=\"none\" stroke=\"black\" cx=\"2306.07\" cy=\"-18\" rx=\"86.38\" ry=\"18\"/>\n<text text-anchor=\"middle\" x=\"2306.07\" y=\"-14.3\" font-family=\"Times,serif\" font-size=\"14.00\">Output EOPatch</text>\n</g>\n<!-- Save Task&#45;&gt;Output EOPatch -->\n<g id=\"edge8\" class=\"edge\">\n<title>Save Task&#45;&gt;Output EOPatch</title>\n<path fill=\"none\" stroke=\"black\" d=\"M2184.13,-18C2191.96,-18 2200.19,-18 2208.5,-18\"/>\n<polygon fill=\"black\" stroke=\"black\" points=\"2208.46,-21.5 2218.46,-18 2208.46,-14.5 2208.46,-21.5\"/>\n</g>\n</g>\n</svg>\n","content_type":"image/svg+xml"},"text/plain":{"content":"<graphviz.graphs.Digraph at 0x7ff4d2974350>","content_type":"text/plain"}}}],"visibility":"show","key":"HdQA4j02pB"}],"visibility":"show","key":"teMGKVlCsb"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.038881,"end_time":"2023-10-24T07:57:58.229755","exception":false,"start_time":"2023-10-24T07:57:58.190874","status":"completed"},"tags":[]},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Now we need to define an area of interest and a time interval for the implementation of our ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"wXaj1oqYH8"},{"type":"inlineCode","value":"EOWorkflow","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"XQdCAKRVQ3"},{"type":"text","value":".","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Po4slQqdD7"}],"key":"HYzOr1kjZ1"}],"visibility":"show","key":"l8OLXLyLNQ"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-10-24T07:57:58.319825Z","iopub.status.busy":"2023-10-24T07:57:58.319452Z","iopub.status.idle":"2023-10-24T07:57:58.322677Z","shell.execute_reply":"2023-10-24T07:57:58.322137Z"},"papermill":{"duration":0.041062,"end_time":"2023-10-24T07:57:58.323937","exception":false,"start_time":"2023-10-24T07:57:58.282875","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# Define the area of interest and time interval\naoi_bbox = BBox(bbox=[5.60, 52.68, 5.75, 52.63], crs=CRS.WGS84)\ntime_interval = ('2017-04-01', '2017-10-31')","visibility":"show","key":"gwmK0cjlU2"},{"type":"output","id":"s8vCamtFKRaUakUnQ5q1i","data":[],"visibility":"show","key":"TncDbObApj"}],"visibility":"show","key":"zHePIwvRYR"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.04023,"end_time":"2023-10-24T07:57:58.416198","exception":false,"start_time":"2023-10-24T07:57:58.375968","status":"completed"},"tags":[]},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Finally, we execute the workflow in the following cell.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"uERGdHByP6"}],"key":"YEHBm3Oy63"}],"visibility":"show","key":"O2mvDQNJ2D"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-10-24T07:57:58.506981Z","iopub.status.busy":"2023-10-24T07:57:58.506697Z","iopub.status.idle":"2023-10-24T07:58:33.812981Z","shell.execute_reply":"2023-10-24T07:58:33.812534Z"},"papermill":{"duration":35.347435,"end_time":"2023-10-24T07:58:33.814405","exception":false,"start_time":"2023-10-24T07:57:58.466970","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"result = workflow.execute({\n    add_data_node: {'bbox': aoi_bbox, 'time_interval': time_interval},\n    save_task_node: {'eopatch_folder': 'eopatch'}\n})","visibility":"show","key":"yFBO2i7XaP"},{"type":"output","id":"yY01pA4Jj4_GPQ2tJc6G9","data":[],"visibility":"show","key":"x5wALkHlfn"}],"visibility":"show","key":"N0jKyAqNYE"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.037605,"end_time":"2023-10-24T07:58:33.909671","exception":false,"start_time":"2023-10-24T07:58:33.872066","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Visualize the ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"BsAGnOUwlE"},{"type":"inlineCode","value":"EOPatch","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"i66NHtctGL"},{"type":"text","value":" output from the ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"JKmLGzY4Ck"},{"type":"inlineCode","value":"EOWorkflow","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"YVfgnXIpS8"}],"identifier":"visualize-the-eopatch-output-from-the-eoworkflow","label":"Visualize the EOPatch output from the EOWorkflow","html_id":"visualize-the-eopatch-output-from-the-eoworkflow","implicit":true,"key":"W3ouwa5dvD"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Once the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"OdD6l8mMe2"},{"type":"inlineCode","value":"EOWorkflow","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"nRNbAHoU5z"},{"type":"text","value":" is run and done processing, we can open the result as an ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"cxgOEAb8a2"},{"type":"inlineCode","value":"EOPatch","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"mT5S4uMQuP"},{"type":"text","value":". The following cell shows the way to open the results of an ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"vaOjf2sjNZ"},{"type":"inlineCode","value":"EOWorkflow","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"NcOJLJiW8A"},{"type":"text","value":" as an ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"sgPPjdt3s0"},{"type":"inlineCode","value":"EOPatch","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"SE0HkohnK7"},{"type":"text","value":" and the structure of EO data stored inside it.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"GLWBjowPhL"}],"key":"b2MzeY8TmZ"}],"visibility":"show","key":"F92GHHnUde"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-10-24T07:58:34.000473Z","iopub.status.busy":"2023-10-24T07:58:34.000131Z","iopub.status.idle":"2023-10-24T07:58:34.003921Z","shell.execute_reply":"2023-10-24T07:58:34.003411Z"},"papermill":{"duration":0.042383,"end_time":"2023-10-24T07:58:34.005003","exception":false,"start_time":"2023-10-24T07:58:33.962620","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# Open data output from `EOWorkflow`\n# The key of outputs is defined by OutputTask()\neop = result.outputs[\"eopatch\"]\neop","visibility":"show","key":"XzmCPahBmB"},{"type":"output","id":"ZgFn4DdNuhAwHYNUqq8n9","data":[{"output_type":"execute_result","execution_count":11,"metadata":{},"data":{"text/plain":{"content":"EOPatch(\n  bbox=BBox(((5.6, 52.63), (5.75, 52.68)), crs=CRS('4326'))\n  timestamps=[datetime.datetime(2017, 4, 3, 10, 41, 38), ..., datetime.datetime(2017, 10, 30, 10, 41, 50)], length=66\n  data_timeless={\n    ARGMAX_B4: numpy.ndarray(shape=(297, 497, 1), dtype=int64)\n    ARGMAX_NDVI: numpy.ndarray(shape=(297, 497, 1), dtype=int64)\n    ARGMAX_NDVI_SLOPE: numpy.ndarray(shape=(297, 497, 1), dtype=uint8)\n    ARGMIN_B4: numpy.ndarray(shape=(297, 497, 1), dtype=int64)\n    ARGMIN_NDVI: numpy.ndarray(shape=(297, 497, 1), dtype=int64)\n    ARGMIN_NDVI_SLOPE: numpy.ndarray(shape=(297, 497, 1), dtype=uint8)\n    STF: numpy.ndarray(shape=(297, 497, 20), dtype=float32)\n  }\n  mask={\n    CLM: numpy.ndarray(shape=(66, 297, 497, 1), dtype=uint8)\n    IS_DATA: numpy.ndarray(shape=(66, 297, 497, 1), dtype=bool)\n    VALID_DATA: numpy.ndarray(shape=(66, 297, 497, 1), dtype=bool)\n  }\n  data={\n    BANDS-S2-L1C: numpy.ndarray(shape=(66, 297, 497, 13), dtype=float32)\n    NDVI: numpy.ndarray(shape=(66, 297, 497, 1), dtype=float32)\n  }\n)","content_type":"text/plain"}}}],"visibility":"show","key":"Jagac0iM7K"}],"visibility":"show","key":"mfoQair02T"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.035373,"end_time":"2023-10-24T07:58:34.094581","exception":false,"start_time":"2023-10-24T07:58:34.059208","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"inlineCode","value":"VALID_DATA","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"UscwDpAYV0"},{"type":"text","value":" mask","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"iAINQf7L9i"}],"identifier":"valid-data-mask","label":"VALID_DATA mask","html_id":"valid-data-mask","implicit":true,"key":"eibyNH8S3r"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Below we visualize how a valid data mask is generated. ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"zcgacXzAIv"},{"type":"link","url":"https://eo-learn.readthedocs.io/en/latest/eolearn.core.core_tasks.html#eolearn.core.core_tasks.ZipFeatureTask","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"inlineCode","value":"ZipFeatureTask","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"J3iKoeWUZD"}],"urlSource":"https://eo-learn.readthedocs.io/en/latest/eolearn.core.core_tasks.html#eolearn.core.core_tasks.ZipFeatureTask","key":"qTaabzsrY9"},{"type":"text","value":" allows us to feed in a self-defined formula that takes multiple inputs and returns a single output. In this Jupyter Notebook we define ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"OR9YOc0big"},{"type":"inlineCode","value":"AddValidDataMaskTask()","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"mtAaLmDJV4"},{"type":"text","value":" on the top of ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"ZnAODQpIn5"},{"type":"inlineCode","value":"ZipFeatureTask","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"qvyrMVEl1y"},{"type":"text","value":" to combine ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"X5wJFdeE8C"},{"type":"inlineCode","value":"IS_DATA","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"c1fQzCILtC"},{"type":"text","value":" (taken from ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"ew5Bang5Dg"},{"type":"link","url":"https://docs.sentinel-hub.com/api/latest/user-guides/datamask/","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"dataMask","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"jKKEbkn7LQ"}],"urlSource":"https://docs.sentinel-hub.com/api/latest/user-guides/datamask/","key":"kg6o6y85Ca"},{"type":"text","value":") and ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"kS0nO6PDQx"},{"type":"inlineCode","value":"CLM","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"vncuEa3k7G"},{"type":"text","value":" (see ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"GCBsbWsDjB"},{"type":"link","url":"https://docs.sentinel-hub.com/api/latest/user-guides/cloud-masks/","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"description","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"uvFcjCSu2z"}],"urlSource":"https://docs.sentinel-hub.com/api/latest/user-guides/cloud-masks/","key":"iAJ2NogyyF"},{"type":"text","value":") to form the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"GgsE15R9LD"},{"type":"inlineCode","value":"VALID_DATA","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"qOh1w9zEVZ"},{"type":"text","value":" mask. Pixel values are valid only if ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"msaep89JSm"},{"type":"inlineCode","value":"IS_DATA","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"p6bQ2xuLQn"},{"type":"text","value":" is ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"bYyhPnEi8z"},{"type":"inlineCode","value":"True","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"tlBRMBXqzx"},{"type":"text","value":" (there is data) and ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"czy4RuY68w"},{"type":"inlineCode","value":"CLM","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"iD3sWsi9w4"},{"type":"text","value":" is ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"SOblxoADCv"},{"type":"inlineCode","value":"False","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"cNaaXfwCKC"},{"type":"text","value":" (no clouds).","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"lj55iegz2R"}],"key":"MPkkGfzSPp"}],"visibility":"show","key":"tk1KceQ3P1"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-10-24T07:58:34.196436Z","iopub.status.busy":"2023-10-24T07:58:34.196130Z","iopub.status.idle":"2023-10-24T07:58:34.398501Z","shell.execute_reply":"2023-10-24T07:58:34.397941Z"},"papermill":{"duration":0.241965,"end_time":"2023-10-24T07:58:34.399589","exception":false,"start_time":"2023-10-24T07:58:34.157624","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"ts_idx = 5\n\nsubplot_kw = {'xticks': [], 'yticks': [], 'frame_on': True}\nfig, axs = plt.subplots(nrows=1, ncols=3, figsize=(15,5), subplot_kw=subplot_kw)\n\nax = axs[0]\nax.imshow(eop.mask['IS_DATA'][ts_idx].squeeze(), vmin=0, vmax=1, cmap='gray')\nax.set_title('IS_DATA')\n\nax = axs[1]\nax.imshow(eop.mask['CLM'][ts_idx].squeeze(),  vmin=0, vmax=1, cmap='gray')\nax.set_title('CLM')\n\nax = axs[2]\nim = ax.imshow(eop.mask['VALID_DATA'][ts_idx].squeeze(),\n               cmap=ListedColormap(['#000000', '#ffffff']), \n               norm=BoundaryNorm([-0.5, 0.5, 1.5], 2))\nax.set_title('VALID_DATA')\n\ncb = fig.colorbar(im, ax=axs.ravel().tolist(), orientation='horizontal', pad=0.05, aspect=100)\ncb.set_ticks([0,1])\ncb.ax.set_xticklabels([False, True], fontsize=12);","visibility":"show","key":"qQVYHc8X9b"},{"type":"output","id":"dS_OajnWplvu6eN_-5Lgx","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"c134dd61d3d909d222b9395001d39838","path":"/example-viewer/build/c134dd61d3d909d222b9395001d39838.png"},"text/plain":{"content":"<Figure size 1500x500 with 4 Axes>","content_type":"text/plain"}}}],"visibility":"show","key":"PIzy1cwOE1"}],"visibility":"show","key":"aQ1mzYNQYH"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.038224,"end_time":"2023-10-24T07:58:34.520450","exception":false,"start_time":"2023-10-24T07:58:34.482226","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Cloud cover","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"S6PqBTGuuH"}],"identifier":"cloud-cover","label":"Cloud cover","html_id":"cloud-cover","implicit":true,"key":"zX7Uoatsic"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"We can also calculate the cloud cover percentage and visualize its changes along the timestamps of data.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"x5ARISqJ3l"}],"key":"C0koKOOavw"}],"visibility":"show","key":"L2gKIZdC23"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-10-24T07:58:34.612671Z","iopub.status.busy":"2023-10-24T07:58:34.612179Z","iopub.status.idle":"2023-10-24T07:58:34.855963Z","shell.execute_reply":"2023-10-24T07:58:34.855571Z"},"papermill":{"duration":0.284259,"end_time":"2023-10-24T07:58:34.857208","exception":false,"start_time":"2023-10-24T07:58:34.572949","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# cloud coverage\ncc = [np.sum(x)/(np.prod(x.shape)) for x in eop.mask['CLM']]\n\nfix, ax = plt.subplots(1,1,figsize=(15,5))\nplt.plot(eop.timestamp, cc, '*--')\nplt.ylabel('Cloud coverage')\nplt.xlabel('Time')\nplt.title('Cloud coverage over an area in the Netherlands - 2017');","visibility":"show","key":"N8qAi8uJLw"},{"type":"output","id":"ybR_KlIMM0sR_1lm6tCHk","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"834608f61d2e97d9b5157e7101676ff5","path":"/example-viewer/build/834608f61d2e97d9b5157e7101676ff5.png"},"text/plain":{"content":"<Figure size 1500x500 with 1 Axes>","content_type":"text/plain"}}}],"visibility":"show","key":"Dry56OhWSo"}],"visibility":"show","key":"igcOxISK2j"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.048967,"end_time":"2023-10-24T07:58:34.974635","exception":false,"start_time":"2023-10-24T07:58:34.925668","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Spatiotemporal features of a specific field","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"WvIb1z9xoL"}],"identifier":"spatiotemporal-features-of-a-specific-field","label":"Spatiotemporal features of a specific field","html_id":"spatiotemporal-features-of-a-specific-field","implicit":true,"key":"hW1GNE7Fp7"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"If we’re looking into a specific field, it is easy to slice the field out of the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"lZnPWHq6gU"},{"type":"inlineCode","value":"EOPatch","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"D3h595RmpV"},{"type":"text","value":" and visualize its NDVI variation thourghout the timestamps.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"DKv9jRDEKV"}],"key":"loGFC6OTyF"}],"visibility":"show","key":"mDZehlKSfz"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-10-24T07:58:35.095565Z","iopub.status.busy":"2023-10-24T07:58:35.095193Z","iopub.status.idle":"2023-10-24T07:58:35.457250Z","shell.execute_reply":"2023-10-24T07:58:35.456820Z"},"papermill":{"duration":0.415778,"end_time":"2023-10-24T07:58:35.458499","exception":false,"start_time":"2023-10-24T07:58:35.042721","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"field_mask = (slice(None), slice(227, 241), slice(314,330))\nndvi_patch = eop.data['NDVI'][field_mask].squeeze(-1)\n\nfix, axs = plt.subplots(1,2,figsize=(20,8))\n\nax = axs[0]\nax.imshow(ndvi_patch[20])\nax.set_aspect('auto')\n\nax = axs[1]\nmean = np.mean(ndvi_patch, axis=(1,2))\nstd = np.std(ndvi_patch, axis=(1,2))\nax.plot(eop.timestamp, mean, color='g', label='NDVI')\nax.fill_between(eop.timestamp, mean-std, mean+std, alpha=0.2, color='g');\nax.set_aspect('auto')\n\nplt.legend(fontsize=15);","visibility":"show","key":"Rcqi7d3kmh"},{"type":"output","id":"QSY_Ulkrh_WK-uU_mYz0i","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"68ffbed2eb5352105cef0cae0e694064","path":"/example-viewer/build/68ffbed2eb5352105cef0cae0e694064.png"},"text/plain":{"content":"<Figure size 2000x800 with 2 Axes>","content_type":"text/plain"}}}],"visibility":"show","key":"OJ30iTvMVa"}],"visibility":"show","key":"jfQy3qEM2F"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.04642,"end_time":"2023-10-24T07:58:35.566016","exception":false,"start_time":"2023-10-24T07:58:35.519596","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Distribution of temporal indices","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"FBckcphvdt"}],"identifier":"distribution-of-temporal-indices","label":"Distribution of temporal indices","html_id":"distribution-of-temporal-indices","implicit":true,"key":"i04wLH7Uuj"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"In the following cell we visualize the distribution of temporal indices having the maximum or minimum values of NDVI features, which gives an overview on when most of the fields have maximum or minimum values of NDVI features.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"dmgjrqppem"}],"key":"nbGR0F2qJt"}],"visibility":"show","key":"axCACRvOau"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-10-24T07:58:35.673600Z","iopub.status.busy":"2023-10-24T07:58:35.673173Z","iopub.status.idle":"2023-10-24T07:58:36.462298Z","shell.execute_reply":"2023-10-24T07:58:36.461824Z"},"papermill":{"duration":0.845424,"end_time":"2023-10-24T07:58:36.471079","exception":false,"start_time":"2023-10-24T07:58:35.625655","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"subplot_kw = {'xticks': [], 'yticks': [], 'frame_on': True}\nfig, axs = plt.subplots(nrows = 2, ncols = 3, figsize=(20,8), subplot_kw = subplot_kw)\n\nax = axs[0,0]\nim = ax.imshow(eop.data_timeless['ARGMAX_NDVI'].squeeze())\nax.set_title(\"Temporal indices for argmax NDVI - no interpolation\", fontsize=15)\ndivider = make_axes_locatable(ax)\ncax = divider.append_axes(\"right\", size=\"2%\", pad=0.05)\nfig.colorbar(im, cax=cax)\n\nax = axs[0,1]\nim = ax.imshow(eop.data_timeless['ARGMIN_NDVI'].squeeze())\nax.set_title(\"Temporal indices for argmin NDVI - no interpolation\", fontsize=15)\ndivider = make_axes_locatable(ax)\ncax = divider.append_axes(\"right\", size=\"2%\", pad=0.05)\nfig.colorbar(im, cax=cax)\n\nax = axs[0,2]\nim = ax.imshow(eop.data_timeless['ARGMAX_NDVI_SLOPE'].squeeze())\nax.set_title(\"Temporal indices for argmax NDVI slope\", fontsize=15)\ndivider = make_axes_locatable(ax)\ncax = divider.append_axes(\"right\", size=\"2%\", pad=0.05)\nfig.colorbar(im, cax=cax)\n\nax = axs[1,1]\nim = ax.imshow(eop.data_timeless['ARGMIN_NDVI_SLOPE'].squeeze())\nax.set_title(\"Temporal indices for argmin NDVI slope\", fontsize=15)\ndivider = make_axes_locatable(ax)\ncax = divider.append_axes(\"right\", size=\"2%\", pad=0.05)\nfig.colorbar(im, cax=cax)\n\nax = axs[1,0]\nim = ax.imshow(eop.data_timeless['ARGMAX_B4'].squeeze())\nax.set_title(\"Temporal indices for argmax red\", fontsize=15)\ndivider = make_axes_locatable(ax)\ncax = divider.append_axes(\"right\", size=\"2%\", pad=0.05)\nfig.colorbar(im, cax=cax)\n\nax = axs[1,2]\nax.axis(False);\n\nplt.tight_layout()","visibility":"show","key":"R0PM5Aam7R"},{"type":"output","id":"4Xi59_6LnSEGvFXK6GsEp","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"4d5a69e678d0e25dd5f087869352d932","path":"/example-viewer/build/4d5a69e678d0e25dd5f087869352d932.png"},"text/plain":{"content":"<Figure size 2000x800 with 11 Axes>","content_type":"text/plain"}}}],"visibility":"show","key":"HsPyKayv7C"}],"visibility":"show","key":"h2eWsrRhl9"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.086009,"end_time":"2023-10-24T07:58:36.666963","exception":false,"start_time":"2023-10-24T07:58:36.580954","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"False color images of NDVI features","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"MHAbjafQue"}],"identifier":"false-color-images-of-ndvi-features","label":"False color images of NDVI features","html_id":"false-color-images-of-ndvi-features","implicit":true,"key":"CHuW81OFKU"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Traditionally a combination of infrared-red-green false color image is useful for vegetation monitoring. Below we visualize the false color images of NDVI features to have an overview on vegetation changes during a crop cycle.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"pthJlldDy8"}],"key":"e10xMZAdWW"}],"visibility":"show","key":"zVCEW74paW"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-10-24T07:58:36.865829Z","iopub.status.busy":"2023-10-24T07:58:36.865463Z","iopub.status.idle":"2023-10-24T07:58:38.044249Z","shell.execute_reply":"2023-10-24T07:58:38.043700Z"},"papermill":{"duration":1.284526,"end_time":"2023-10-24T07:58:38.060241","exception":false,"start_time":"2023-10-24T07:58:36.775715","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"subplot_kw = {'xticks': [], 'yticks': [], 'frame_on': True}\nfig, axs = plt.subplots(nrows = 2, ncols = 3, figsize=(20,10), subplot_kw = subplot_kw)\n\nax = axs[0,0]\nax.imshow(np.clip(eop.data_timeless['STF'][:,:,[2,1,0]], 0, 1))\nax.set_title(\"IR-R-G reflectances for argmax NDVI\", fontsize=15)\n\nax = axs[0,1]\nax.imshow(np.clip(eop.data_timeless['STF'][:,:,[6,5,4]], 0, 1))\nax.set_title(\"IR-R-G reflectances for argmin NDVI\", fontsize=15)\n\nax = axs[0,2]\nax.imshow(np.clip(eop.data_timeless['STF'][:,:,[10,9,8]], 0, 1))\nax.set_title(\"IR-R-G reflectances for argmax NDVI slope\", fontsize=15)\n\nax = axs[1,1]\nax.imshow(np.clip(eop.data_timeless['STF'][:,:,[14,13,12]], 0, 1))\nax.set_title(\"IR-R-G reflectances for argmin NDVI slope\", fontsize=15)\n\nax = axs[1,0]\nax.imshow(np.clip(eop.data_timeless['STF'][:,:,[18,17,16]], 0, 1))\nax.set_title(\"IR-R-G reflectances for argmax red\", fontsize=15);\n\nax = axs[1,2]\nax.axis(False);\n\nplt.tight_layout()","visibility":"show","key":"Mdg0dh5lBa"},{"type":"output","id":"kytsczMpwdOmcqhn2h9sW","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"982dd91fd1d666c53814aa8b7146b2fb","path":"/example-viewer/build/982dd91fd1d666c53814aa8b7146b2fb.png"},"text/plain":{"content":"<Figure size 2000x1000 with 6 Axes>","content_type":"text/plain"}}}],"visibility":"show","key":"fMfbBAJ3hz"}],"visibility":"show","key":"epVoucWDqO"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.120839,"end_time":"2023-10-24T07:58:38.326440","exception":false,"start_time":"2023-10-24T07:58:38.205601","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Load an existing ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"RyiPaEKmdE"},{"type":"inlineCode","value":"EOPatch","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"wVu9YUg9wC"},{"type":"text","value":" from a filesystem to build another ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"UXooquOIw0"},{"type":"inlineCode","value":"EOWorkflow","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"SmQ6K4lCum"}],"identifier":"load-an-existing-eopatch-from-a-filesystem-to-build-another-eoworkflow","label":"Load an existing EOPatch from a filesystem to build another EOWorkflow","html_id":"load-an-existing-eopatch-from-a-filesystem-to-build-another-eoworkflow","implicit":true,"key":"QqWJAq3KP4"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"In the previous processing chain, we calculated spatiotemporal indices via masking out invalid data which could lead to data gaps within the time interval. From a machine learning perspective, we train models to recognize features of indices’ temporal changes, meaning that data gaps should be avoided. One way to solve this problem is to create a homogenous temporal data-stack using interpolation. Since the changes of vegetation is usually a slow process over time, it is reasonable to implement a linear interpolation to fill up the missing data to make our data better for ML training. Here we will show how to build another ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"IG26cosGgW"},{"type":"inlineCode","value":"EOWorkflow","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"esWNCckXyi"},{"type":"text","value":" to implement interpolation before calculating spatiotemporal indices in a few steps:","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"I9j17iXRIJ"}],"key":"lnhRStsx1s"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":4,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Load the previously saved ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"QSbk5T0wIQ"},{"type":"inlineCode","value":"EOPatch","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"ObIf2lrrCZ"}],"key":"NmIP8MgyMP"},{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Define ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"iCs81uxpNo"},{"type":"inlineCode","value":"EOTasks","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"ODptWPafR3"},{"type":"text","value":" implementing interpolation","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"UpEfizJ3zt"}],"key":"TOXphGEIdJ"},{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Wrap ","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"CvfHjBLDMR"},{"type":"inlineCode","value":"EOTasks","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"ngEbdCdWao"},{"type":"text","value":" into ","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"NiIGFXnX4O"},{"type":"inlineCode","value":"EONodes","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"Io5m6o6Lgl"}],"key":"RoVR5flimV"},{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Build a new ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"dYx1R983v3"},{"type":"inlineCode","value":"EOWorkflow","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"rQa5jaJy5C"},{"type":"text","value":" from ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"CoNgGdkA7E"},{"type":"inlineCode","value":"EONodes","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"nhYLooVLDu"}],"key":"ia2mIwkHBa"}],"key":"aOUrCLoaaf"}],"visibility":"show","key":"bdAVI0thA6"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-10-24T07:58:38.576308Z","iopub.status.busy":"2023-10-24T07:58:38.576056Z","iopub.status.idle":"2023-10-24T07:58:38.580670Z","shell.execute_reply":"2023-10-24T07:58:38.580167Z"},"papermill":{"duration":0.126267,"end_time":"2023-10-24T07:58:38.581680","exception":false,"start_time":"2023-10-24T07:58:38.455413","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# Load existing `EOPatch`\nload_task = LoadTask('./stf/')\n\n# Define new `EOTasks`\ninterp_ndvi = LinearInterpolationTask((FeatureType.DATA, 'NDVI'), mask_feature=(FeatureType.MASK, 'VALID_DATA'))\n\ninterp_bands = LinearInterpolationTask((FeatureType.DATA, 'BANDS-S2-L1C'), mask_feature=(FeatureType.MASK, 'VALID_DATA'))\n\nadd_maxmin_ndvi = AddMaxMinTemporalIndicesTask(mask_data=False)\n\nadd_maxmin_red = AddMaxMinTemporalIndicesTask(data_feature='BANDS-S2-L1C', \n                                              data_index=3, \n                                              amax_data_feature='ARGMAX_B4',\n                                              amin_data_feature='ARGMIN_B4',\n                                              mask_data=False)\n\nadd_maxmin_ndvi_sl = AddMaxMinNDVISlopeIndicesTask()\n\nadd_stf = AddSpatioTemporalFeaturesTask()\n\noutput = OutputTask(\"interp_eopatch\")","visibility":"show","key":"Es73gL3BxI"},{"type":"output","id":"YicPkiwV8cH073yjA5BW8","data":[],"visibility":"show","key":"t4EMozoWqs"}],"visibility":"show","key":"hw7mgq01ND"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-10-24T07:58:38.823396Z","iopub.status.busy":"2023-10-24T07:58:38.823140Z","iopub.status.idle":"2023-10-24T07:58:38.871301Z","shell.execute_reply":"2023-10-24T07:58:38.870757Z"},"papermill":{"duration":0.159381,"end_time":"2023-10-24T07:58:38.872359","exception":false,"start_time":"2023-10-24T07:58:38.712978","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# Wrap `EOTasks` into `EONodes`\nload_node = EONode(load_task, inputs=[], name=\"Load EOPatch\")\ninterp_ndvi_node = EONode(interp_ndvi, inputs=[load_node], name=\"Interpolate NDVI Task\")\ninterp_bands_node = EONode(interp_bands, inputs=[interp_ndvi_node], name=\"Interpolate Bands Task\")\nadd_maxmin_ndvi_node = EONode(add_maxmin_ndvi, inputs=[interp_bands_node], name=\"Add MaxMin NDVI Task\")\nadd_maxmin_red_node = EONode(add_maxmin_red, inputs=[add_maxmin_ndvi_node], name=\"Add ArgMaxMin Red Task\")\nadd_maxmin_ndvi_sl_node = EONode(add_maxmin_ndvi_sl, inputs=[add_maxmin_red_node], name=\"Add MaxMin NDVI Slope Task\")\nadd_stf_node = EONode(add_stf, inputs=[add_maxmin_ndvi_sl_node], name=\"Add Spatiotemporal Features Task\")\noutput_node = EONode(output, inputs=[add_stf_node], name=\"Output Interpolated EOPatch\")\n\n# Assemble `EONodes` to an `EOWorkflow`\nworkflow_with_interp = EOWorkflow(\n    [\n        load_node,\n        interp_ndvi_node,\n        interp_bands_node,\n        add_maxmin_ndvi_node,\n        add_maxmin_red_node,\n        add_maxmin_ndvi_sl_node,\n        add_stf_node,\n        output_node\n    ]\n)\n\n# Visualize new `EOWorkflow`\nworkflow_with_interp.dependency_graph()","visibility":"show","key":"OzcSxuXYNq"},{"type":"output","id":"ohFQ37TmWEWkS__yJ9I3g","data":[{"output_type":"execute_result","execution_count":18,"metadata":{},"data":{"image/svg+xml":{"content":"<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"no\"?>\n<!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 1.1//EN\"\n \"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\">\n<!-- Generated by graphviz version 8.0.3 (20230418.1244)\n -->\n<!-- Pages: 1 -->\n<svg width=\"2319pt\" height=\"44pt\"\n viewBox=\"0.00 0.00 2319.02 44.00\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\">\n<g id=\"graph0\" class=\"graph\" transform=\"scale(1 1) rotate(0) translate(4 40)\">\n<polygon fill=\"white\" stroke=\"none\" points=\"-4,4 -4,-40 2315.02,-40 2315.02,4 -4,4\"/>\n<!-- Load EOPatch -->\n<g id=\"node1\" class=\"node\">\n<title>Load EOPatch</title>\n<ellipse fill=\"none\" stroke=\"black\" cx=\"76.04\" cy=\"-18\" rx=\"76.09\" ry=\"18\"/>\n<text text-anchor=\"middle\" x=\"76.04\" y=\"-14.3\" font-family=\"Times,serif\" font-size=\"14.00\">Load EOPatch</text>\n</g>\n<!-- Interpolate NDVI Task -->\n<g id=\"node2\" class=\"node\">\n<title>Interpolate NDVI Task</title>\n<ellipse fill=\"none\" stroke=\"black\" cx=\"302.48\" cy=\"-18\" rx=\"114.28\" ry=\"18\"/>\n<text text-anchor=\"middle\" x=\"302.48\" y=\"-14.3\" font-family=\"Times,serif\" font-size=\"14.00\">Interpolate NDVI Task</text>\n</g>\n<!-- Load EOPatch&#45;&gt;Interpolate NDVI Task -->\n<g id=\"edge1\" class=\"edge\">\n<title>Load EOPatch&#45;&gt;Interpolate NDVI Task</title>\n<path fill=\"none\" stroke=\"black\" d=\"M152.4,-18C160.46,-18 168.8,-18 177.24,-18\"/>\n<polygon fill=\"black\" stroke=\"black\" points=\"176.96,-21.5 186.96,-18 176.96,-14.5 176.96,-21.5\"/>\n</g>\n<!-- Interpolate Bands Task -->\n<g id=\"node3\" class=\"node\">\n<title>Interpolate Bands Task</title>\n<ellipse fill=\"none\" stroke=\"black\" cx=\"571.16\" cy=\"-18\" rx=\"118.08\" ry=\"18\"/>\n<text text-anchor=\"middle\" x=\"571.16\" y=\"-14.3\" font-family=\"Times,serif\" font-size=\"14.00\">Interpolate Bands Task</text>\n</g>\n<!-- Interpolate NDVI Task&#45;&gt;Interpolate Bands Task -->\n<g id=\"edge2\" class=\"edge\">\n<title>Interpolate NDVI Task&#45;&gt;Interpolate Bands Task</title>\n<path fill=\"none\" stroke=\"black\" d=\"M416.96,-18C425.24,-18 433.62,-18 441.98,-18\"/>\n<polygon fill=\"black\" stroke=\"black\" points=\"441.94,-21.5 451.94,-18 441.94,-14.5 441.94,-21.5\"/>\n</g>\n<!-- Add MaxMin NDVI Task -->\n<g id=\"node4\" class=\"node\">\n<title>Add MaxMin NDVI Task</title>\n<ellipse fill=\"none\" stroke=\"black\" cx=\"846.98\" cy=\"-18\" rx=\"121.58\" ry=\"18\"/>\n<text text-anchor=\"middle\" x=\"846.98\" y=\"-14.3\" font-family=\"Times,serif\" font-size=\"14.00\">Add MaxMin NDVI Task</text>\n</g>\n<!-- Interpolate Bands Task&#45;&gt;Add MaxMin NDVI Task -->\n<g id=\"edge3\" class=\"edge\">\n<title>Interpolate Bands Task&#45;&gt;Add MaxMin NDVI Task</title>\n<path fill=\"none\" stroke=\"black\" d=\"M689.48,-18C697.65,-18 705.92,-18 714.17,-18\"/>\n<polygon fill=\"black\" stroke=\"black\" points=\"713.98,-21.5 723.98,-18 713.98,-14.5 713.98,-21.5\"/>\n</g>\n<!-- Add ArgMaxMin Red Task -->\n<g id=\"node5\" class=\"node\">\n<title>Add ArgMaxMin Red Task</title>\n<ellipse fill=\"none\" stroke=\"black\" cx=\"1135.81\" cy=\"-18\" rx=\"131.08\" ry=\"18\"/>\n<text text-anchor=\"middle\" x=\"1135.81\" y=\"-14.3\" font-family=\"Times,serif\" font-size=\"14.00\">Add ArgMaxMin Red Task</text>\n</g>\n<!-- Add MaxMin NDVI Task&#45;&gt;Add ArgMaxMin Red Task -->\n<g id=\"edge4\" class=\"edge\">\n<title>Add MaxMin NDVI Task&#45;&gt;Add ArgMaxMin Red Task</title>\n<path fill=\"none\" stroke=\"black\" d=\"M968.79,-18C976.99,-18 985.29,-18 993.58,-18\"/>\n<polygon fill=\"black\" stroke=\"black\" points=\"993.46,-21.5 1003.46,-18 993.46,-14.5 993.46,-21.5\"/>\n</g>\n<!-- Add MaxMin NDVI Slope Task -->\n<g id=\"node6\" class=\"node\">\n<title>Add MaxMin NDVI Slope Task</title>\n<ellipse fill=\"none\" stroke=\"black\" cx=\"1453.24\" cy=\"-18\" rx=\"150.27\" ry=\"18\"/>\n<text text-anchor=\"middle\" x=\"1453.24\" y=\"-14.3\" font-family=\"Times,serif\" font-size=\"14.00\">Add MaxMin NDVI Slope Task</text>\n</g>\n<!-- Add ArgMaxMin Red Task&#45;&gt;Add MaxMin NDVI Slope Task -->\n<g id=\"edge5\" class=\"edge\">\n<title>Add ArgMaxMin Red Task&#45;&gt;Add MaxMin NDVI Slope Task</title>\n<path fill=\"none\" stroke=\"black\" d=\"M1267.38,-18C1275.46,-18 1283.63,-18 1291.81,-18\"/>\n<polygon fill=\"black\" stroke=\"black\" points=\"1291.56,-21.5 1301.56,-18 1291.56,-14.5 1291.56,-21.5\"/>\n</g>\n<!-- Add Spatiotemporal Features Task -->\n<g id=\"node7\" class=\"node\">\n<title>Add Spatiotemporal Features Task</title>\n<ellipse fill=\"none\" stroke=\"black\" cx=\"1810.31\" cy=\"-18\" rx=\"170.87\" ry=\"18\"/>\n<text text-anchor=\"middle\" x=\"1810.31\" y=\"-14.3\" font-family=\"Times,serif\" font-size=\"14.00\">Add Spatiotemporal Features Task</text>\n</g>\n<!-- Add MaxMin NDVI Slope Task&#45;&gt;Add Spatiotemporal Features Task -->\n<g id=\"edge6\" class=\"edge\">\n<title>Add MaxMin NDVI Slope Task&#45;&gt;Add Spatiotemporal Features Task</title>\n<path fill=\"none\" stroke=\"black\" d=\"M1603.79,-18C1611.89,-18 1620.08,-18 1628.27,-18\"/>\n<polygon fill=\"black\" stroke=\"black\" points=\"1628.05,-21.5 1638.05,-18 1628.05,-14.5 1628.05,-21.5\"/>\n</g>\n<!-- Output Interpolated EOPatch -->\n<g id=\"node8\" class=\"node\">\n<title>Output Interpolated EOPatch</title>\n<ellipse fill=\"none\" stroke=\"black\" cx=\"2164.13\" cy=\"-18\" rx=\"146.77\" ry=\"18\"/>\n<text text-anchor=\"middle\" x=\"2164.13\" y=\"-14.3\" font-family=\"Times,serif\" font-size=\"14.00\">Output Interpolated EOPatch</text>\n</g>\n<!-- Add Spatiotemporal Features Task&#45;&gt;Output Interpolated EOPatch -->\n<g id=\"edge7\" class=\"edge\">\n<title>Add Spatiotemporal Features Task&#45;&gt;Output Interpolated EOPatch</title>\n<path fill=\"none\" stroke=\"black\" d=\"M1981.55,-18C1989.78,-18 1998.03,-18 2006.22,-18\"/>\n<polygon fill=\"black\" stroke=\"black\" points=\"2005.96,-21.5 2015.96,-18 2005.96,-14.5 2005.96,-21.5\"/>\n</g>\n</g>\n</svg>\n","content_type":"image/svg+xml"},"text/plain":{"content":"<graphviz.graphs.Digraph at 0x7ff4d0391690>","content_type":"text/plain"}}}],"visibility":"show","key":"UbqKnnxbed"}],"visibility":"show","key":"sLc4aqFyO4"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-10-24T07:58:39.117931Z","iopub.status.busy":"2023-10-24T07:58:39.117438Z","iopub.status.idle":"2023-10-24T07:58:54.131748Z","shell.execute_reply":"2023-10-24T07:58:54.131186Z"},"papermill":{"duration":15.141473,"end_time":"2023-10-24T07:58:54.133414","exception":false,"start_time":"2023-10-24T07:58:38.991941","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# Execute new `EOWorkflow`\nresult_with_interp = workflow_with_interp.execute({\n    load_node: {'eopatch_folder':'eopatch'}\n})","visibility":"show","key":"R4Pp61qCOq"},{"type":"output","id":"NU5zhc1HrPEDaMcCwnOjp","data":[],"visibility":"show","key":"eSjvwELKYG"}],"visibility":"show","key":"Pq3n7D9drd"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.113619,"end_time":"2023-10-24T07:58:54.380415","exception":false,"start_time":"2023-10-24T07:58:54.266796","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Visualize interpolated data","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ylVFatQWme"}],"identifier":"visualize-interpolated-data","label":"Visualize interpolated data","html_id":"visualize-interpolated-data","implicit":true,"key":"LkHxxQYXdn"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Again we can vasualize the interpolated data in the same way as demonstrated above and see how data gaps over time could affect on the features of indices’ temporal variation.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"BEDM0vii1X"}],"key":"Spx9uud6bN"}],"visibility":"show","key":"ggOPt0vyHO"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-10-24T07:58:54.621592Z","iopub.status.busy":"2023-10-24T07:58:54.621230Z","iopub.status.idle":"2023-10-24T07:58:54.625301Z","shell.execute_reply":"2023-10-24T07:58:54.624807Z"},"papermill":{"duration":0.11794,"end_time":"2023-10-24T07:58:54.626324","exception":false,"start_time":"2023-10-24T07:58:54.508384","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# Open data output from `EOWorkflow`\neop_interp = result_with_interp.outputs[\"interp_eopatch\"]\neop_interp","visibility":"show","key":"Jz5I4f7Xwb"},{"type":"output","id":"IRdG0rx3CNI9a7AzEAGNg","data":[{"output_type":"execute_result","execution_count":20,"metadata":{},"data":{"text/plain":{"content":"EOPatch(\n  bbox=BBox(((5.6, 52.63), (5.75, 52.68)), crs=CRS('4326'))\n  timestamps=[datetime.datetime(2017, 4, 3, 10, 41, 38), ..., datetime.datetime(2017, 10, 30, 10, 41, 50)], length=66\n  data_timeless={\n    ARGMAX_B4: numpy.ndarray(shape=(297, 497, 1), dtype=int64)\n    ARGMAX_NDVI: numpy.ndarray(shape=(297, 497, 1), dtype=int64)\n    ARGMAX_NDVI_SLOPE: numpy.ndarray(shape=(297, 497, 1), dtype=uint8)\n    ARGMIN_B4: numpy.ndarray(shape=(297, 497, 1), dtype=int64)\n    ARGMIN_NDVI: numpy.ndarray(shape=(297, 497, 1), dtype=int64)\n    ARGMIN_NDVI_SLOPE: numpy.ndarray(shape=(297, 497, 1), dtype=uint8)\n    STF: numpy.ndarray(shape=(297, 497, 20), dtype=float64)\n  }\n  mask={\n    CLM: numpy.ndarray(shape=(66, 297, 497, 1), dtype=uint8)\n    IS_DATA: numpy.ndarray(shape=(66, 297, 497, 1), dtype=bool)\n    VALID_DATA: numpy.ndarray(shape=(66, 297, 497, 1), dtype=bool)\n  }\n  data={\n    BANDS-S2-L1C: numpy.ndarray(shape=(66, 297, 497, 13), dtype=float64)\n    NDVI: numpy.ndarray(shape=(66, 297, 497, 1), dtype=float64)\n  }\n)","content_type":"text/plain"}}}],"visibility":"show","key":"Wc5sJl7XO3"}],"visibility":"show","key":"hpH3bQpTrG"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-10-24T07:58:54.871333Z","iopub.status.busy":"2023-10-24T07:58:54.871060Z","iopub.status.idle":"2023-10-24T07:58:55.255138Z","shell.execute_reply":"2023-10-24T07:58:55.254710Z"},"papermill":{"duration":0.502849,"end_time":"2023-10-24T07:58:55.256217","exception":false,"start_time":"2023-10-24T07:58:54.753368","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# Visualize spatiotemporal features of a specific field\nfield_mask = (slice(None), slice(227, 241), slice(314,330))\nndvi_patch = eop_interp.data['NDVI'][field_mask].squeeze(-1)\n\nfix, axs = plt.subplots(1,2,figsize=(20,8))\n\nax = axs[0]\nax.imshow(ndvi_patch[20])\nax.set_aspect('auto')\n\nax = axs[1]\nmean = np.mean(ndvi_patch, axis=(1,2))\nstd = np.std(ndvi_patch, axis=(1,2))\nax.plot(eop_interp.timestamp, mean, color='g', label='NDVI')\nax.fill_between(eop_interp.timestamp, mean-std, mean+std, alpha=0.2, color='g');\nax.set_aspect('auto')\n\nplt.legend(fontsize=15);","visibility":"show","key":"j4IPhax5eL"},{"type":"output","id":"H-jUj2-F6pIt33k5Dkz3o","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"af69eabd0d8ef75a87cc07d481bdcce2","path":"/example-viewer/build/af69eabd0d8ef75a87cc07d481bdcce2.png"},"text/plain":{"content":"<Figure size 2000x800 with 2 Axes>","content_type":"text/plain"}}}],"visibility":"show","key":"o19N3knfAC"}],"visibility":"show","key":"G9b8IoMx23"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-10-24T07:58:55.528116Z","iopub.status.busy":"2023-10-24T07:58:55.527720Z","iopub.status.idle":"2023-10-24T07:58:56.345807Z","shell.execute_reply":"2023-10-24T07:58:56.345300Z"},"papermill":{"duration":0.954257,"end_time":"2023-10-24T07:58:56.353309","exception":false,"start_time":"2023-10-24T07:58:55.399052","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# Distribution of temporal indices\nsubplot_kw = {'xticks': [], 'yticks': [], 'frame_on': True}\nfig, axs = plt.subplots(nrows = 2, ncols = 3, figsize=(20,8), subplot_kw = subplot_kw)\n\nax = axs[0,0]\nim = ax.imshow(eop_interp.data_timeless['ARGMAX_NDVI'].squeeze())\nax.set_title(\"Temporal indices for argmax NDVI\", fontsize=15)\ndivider = make_axes_locatable(ax)\ncax = divider.append_axes(\"right\", size=\"2%\", pad=0.05)\nfig.colorbar(im, cax=cax)\n\nax = axs[0,1]\nim = ax.imshow(eop_interp.data_timeless['ARGMIN_NDVI'].squeeze())\nax.set_title(\"Temporal indices for argmin NDVI\", fontsize=15)\ndivider = make_axes_locatable(ax)\ncax = divider.append_axes(\"right\", size=\"2%\", pad=0.05)\nfig.colorbar(im, cax=cax)\n\nax = axs[0,2]\nim = ax.imshow(eop_interp.data_timeless['ARGMAX_NDVI_SLOPE'].squeeze())\nax.set_title(\"Temporal indices for argmax NDVI slope\", fontsize=15)\ndivider = make_axes_locatable(ax)\ncax = divider.append_axes(\"right\", size=\"2%\", pad=0.05)\nfig.colorbar(im, cax=cax)\n\nax = axs[1,1]\nim = ax.imshow(eop_interp.data_timeless['ARGMIN_NDVI_SLOPE'].squeeze())\nax.set_title(\"Temporal indices for argmin NDVI slope\", fontsize=15)\ndivider = make_axes_locatable(ax)\ncax = divider.append_axes(\"right\", size=\"2%\", pad=0.05)\nfig.colorbar(im, cax=cax)\n\nax = axs[1,0]\nim = ax.imshow(eop_interp.data_timeless['ARGMAX_B4'].squeeze())\nax.set_title(\"Temporal indices for argmax red\", fontsize=15)\ndivider = make_axes_locatable(ax)\ncax = divider.append_axes(\"right\", size=\"2%\", pad=0.05)\nfig.colorbar(im, cax=cax)\n\nax = axs[1,2]\nax.axis(False);\n\nplt.tight_layout()","visibility":"show","key":"rDuOXs0R1b"},{"type":"output","id":"xrbDrstXHAYDw2CsyhVi3","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"f7abb85f159b913035908b899e987bfc","path":"/example-viewer/build/f7abb85f159b913035908b899e987bfc.png"},"text/plain":{"content":"<Figure size 2000x800 with 11 Axes>","content_type":"text/plain"}}}],"visibility":"show","key":"AEfZIJubpN"}],"visibility":"show","key":"LHnqPQN56K"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-10-24T07:58:56.689043Z","iopub.status.busy":"2023-10-24T07:58:56.688719Z","iopub.status.idle":"2023-10-24T07:58:57.852388Z","shell.execute_reply":"2023-10-24T07:58:57.851852Z"},"papermill":{"duration":1.329205,"end_time":"2023-10-24T07:58:57.860749","exception":false,"start_time":"2023-10-24T07:58:56.531544","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# False color images of NDVI features\nsubplot_kw = {'xticks': [], 'yticks': [], 'frame_on': True}\nfig, axs = plt.subplots(nrows = 2, ncols = 3, figsize=(20,10), subplot_kw = subplot_kw)\n\nax = axs[0,0]\nax.imshow(np.clip(eop_interp.data_timeless['STF'][:,:,[2,1,0]], 0, 1))\nax.set_title(\"IR-R-G reflectances for argmax NDVI\", fontsize=15)\n\nax = axs[0,1]\nax.imshow(np.clip(eop_interp.data_timeless['STF'][:,:,[6,5,4]], 0, 1))\nax.set_title(\"IR-R-G reflectances for argmin NDVI\", fontsize=15)\n\nax = axs[0,2]\nax.imshow(np.clip(eop_interp.data_timeless['STF'][:,:,[10,9,8]], 0, 1))\nax.set_title(\"IR-R-G reflectances for argmax NDVI slope\", fontsize=15)\n\nax = axs[1,1]\nax.imshow(np.clip(eop_interp.data_timeless['STF'][:,:,[14,13,12]], 0, 1))\nax.set_title(\"IR-R-G reflectances for argmin NDVI slope\", fontsize=15)\n\nax = axs[1,0]\nax.imshow(np.clip(eop_interp.data_timeless['STF'][:,:,[18,17,16]], 0, 1))\nax.set_title(\"IR-R-G reflectances for argmax red\", fontsize=15);\n\nax = axs[1,2]\nax.axis(False);\n\nplt.tight_layout()","visibility":"show","key":"koZsWuIANs"},{"type":"output","id":"8AZiamUtyP8H0Te5z0oqc","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"00ebf0fca107078f83c6fa1b8f93d144","path":"/example-viewer/build/00ebf0fca107078f83c6fa1b8f93d144.png"},"text/plain":{"content":"<Figure size 2000x1000 with 6 Axes>","content_type":"text/plain"}}}],"visibility":"show","key":"ZIAGBjipro"}],"visibility":"show","key":"djUGDyyH2Y"}],"key":"UjMobmMgrV"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"NDVI timeline","url":"/external-notebooks/eurodatacube/notebooks/notebooks/curated/edc-usecase-ndvi-timeline","group":"Curated"},"next":{"title":"Earth System Data Lab Tutorial @ Euro Data Cube","url":"/external-notebooks/eurodatacube/notebooks/notebooks/curated/esdl-edc-v0-2","group":"Curated"}}},"domain":"http://localhost:3000"}