{"version":1,"kind":"Notebook","sha256":"416c8177d561fc3a5f21bcdb24041f026a3c852bf6f64cd1ee4d6cedf4e29498","slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.edc-sentinel-hub-data-access","location":"/external_notebooks/eurodatacube/notebooks/notebooks/curated/EDC_Sentinel_Hub-Data-access.ipynb","dependencies":[],"frontmatter":{"title":"EDC Sentinel Hub - data access using xcube","content_includes_title":true,"kernelspec":{"name":"conda-env-users-edc-2023.10-01-py","display_name":"EDC 2022.02 (Python3)","language":"python"},"github":"https://github.com/eurodatacube/example-viewer","subject":"Euro Data Cube Examples","numbering":{"title":{"offset":5}},"edit_url":"https://github.com/eurodatacube/example-viewer/blob/main/external_notebooks/eurodatacube/notebooks/notebooks/curated/EDC_Sentinel_Hub-Data-access.ipynb","exports":[{"format":"ipynb","filename":"EDC_Sentinel_Hub-Data-access.ipynb","url":"/example-viewer/build/EDC_Sentinel_Hub-Dat-dcdfa7ecb36ffd4e34905d03a07ffe96.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-10-24T07:56:53.995804Z","iopub.status.busy":"2023-10-24T07:56:53.995363Z","iopub.status.idle":"2023-10-24T07:56:54.040329Z","shell.execute_reply":"2023-10-24T07:56:54.039864Z"},"papermill":{"duration":0.071629,"end_time":"2023-10-24T07:56:54.041354","exception":false,"start_time":"2023-10-24T07:56:53.969725","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"from edc import check_compatibility\ncheck_compatibility(\"user-2023.10-01\", dependencies=[\"SH\"])","visibility":"show","key":"vQGq3wS9kc"},{"type":"output","id":"iL02q9JtH1tsSLBQz_RlK","data":[{"output_type":"display_data","metadata":{},"data":{"text/html":{"content":"<script type=\"text/javascript\">\n        function toggle(id) {\n            el = document.getElementById(id);\n            el.style.display = el.style.display === \"none\" ? \"block\" : \"none\";\n        }\n    </script>","content_type":"text/html"},"text/plain":{"content":"<IPython.core.display.HTML object>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"text/html":{"content":"This notebook is compatible with this base image version (user-2023.10-01).","content_type":"text/html"},"text/plain":{"content":"<IPython.core.display.HTML object>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"text/markdown":{"content":"\n\n---------\n\nThe following environment variables are available:\n\n* `SH_CLIENT_ID`, `SH_INSTANCE_ID`, `SH_CLIENT_NAME`, `SH_CLIENT_SECRET`\n","content_type":"text/markdown"},"text/plain":{"content":"<IPython.core.display.Markdown object>","content_type":"text/plain"}}}],"visibility":"show","key":"S080I0nTvc"}],"visibility":"show","key":"VM3VVrDzVh"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.021708,"end_time":"2023-10-24T07:56:54.107706","exception":false,"start_time":"2023-10-24T07:56:54.085998","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":1,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"EDC Sentinel Hub - data access using xcube","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"OhrEZ4WVpc"}],"identifier":"edc-sentinel-hub-data-access-using-xcube","label":"EDC Sentinel Hub - data access using xcube","html_id":"edc-sentinel-hub-data-access-using-xcube","implicit":true,"key":"VCEUtr4Vxc"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"This notebook shows the various ways to open data cubes from Sentinel Hub (SH) for a given time range, region, and spatial resolution:","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"aU1PwPPmQU"}],"key":"L5T7BWxVuk"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":5,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"A ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"nv3b8ggPpz"},{"type":"strong","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"temporarily regular Sentinel-2 cube","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"fislwt2CMS"}],"key":"HULWXQdy6C"},{"type":"text","value":" with aggregated observations that fall into equal-size time periods;","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"TJth2KRX4P"}],"key":"jVrdib0lRi"},{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"A ","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"f5HEP1MytZ"},{"type":"strong","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"temporarily irregular Sentinel-2 cube","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"l6X2u3yufO"}],"key":"lbXM9EnoWU"},{"type":"text","value":" which only includes time stamps where there were valid observations;","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"lo6othlJQK"}],"key":"ONjfxGOp37"},{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"A cube using ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"lqs34XramI"},{"type":"strong","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"projected coordinates","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"lTU32hhGc8"}],"key":"gL6uJcqjGB"},{"type":"text","value":".","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"oc8uavfqeb"}],"key":"Kmx8s7dGfT"}],"key":"SBW5RGxLmw"}],"visibility":"show","key":"EVBneVD7MY"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-10-24T07:56:54.179926Z","iopub.status.busy":"2023-10-24T07:56:54.179532Z","iopub.status.idle":"2023-10-24T07:56:55.321432Z","shell.execute_reply":"2023-10-24T07:56:55.320865Z"},"papermill":{"duration":1.168942,"end_time":"2023-10-24T07:56:55.323006","exception":false,"start_time":"2023-10-24T07:56:54.154064","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# xcube_sh imports\nfrom xcube_sh.cube import open_cube\nfrom xcube_sh.config import CubeConfig\nfrom xcube_sh.observers import Observers\nfrom xcube_sh.viewer import ViewerServer\n\n# xcube imports\nfrom xcube.core.maskset import MaskSet\nfrom xcube.core.geom import mask_dataset_by_geometry\nfrom xcube.core.geom import clip_dataset_by_geometry\n\n# Various utilities\nimport json\nimport xarray as xr\nimport shapely.geometry\nimport IPython.display\nimport zarr","visibility":"show","key":"muoVRQY8OT"},{"type":"output","id":"cTNrVBap1QLaC3FOoZ9tC","data":[],"visibility":"show","key":"eWyWQVo75I"}],"visibility":"show","key":"ifHQyiu6EQ"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-10-24T07:56:55.382669Z","iopub.status.busy":"2023-10-24T07:56:55.382420Z","iopub.status.idle":"2023-10-24T07:56:55.728496Z","shell.execute_reply":"2023-10-24T07:56:55.728021Z"},"papermill":{"duration":0.370871,"end_time":"2023-10-24T07:56:55.729986","exception":false,"start_time":"2023-10-24T07:56:55.359115","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"%matplotlib inline","visibility":"show","key":"lfLvtYqkhe"},{"type":"output","id":"f2gPgQZMGNGapBHwV0M3e","data":[],"visibility":"show","key":"mkUEoKTnQK"}],"visibility":"show","key":"OtfTg9zXI0"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-10-24T07:56:55.791934Z","iopub.status.busy":"2023-10-24T07:56:55.791371Z","iopub.status.idle":"2023-10-24T07:56:55.794257Z","shell.execute_reply":"2023-10-24T07:56:55.793819Z"},"papermill":{"duration":0.027243,"end_time":"2023-10-24T07:56:55.795305","exception":false,"start_time":"2023-10-24T07:56:55.768062","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"import xcube\nimport xcube_sh","visibility":"show","key":"bGNJqEOWRk"},{"type":"output","id":"KggATAIyxzlZItNkNVZdZ","data":[],"visibility":"show","key":"SlH4ZAMtxn"}],"visibility":"show","key":"P6Lj6bc8G1"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-10-24T07:56:55.853175Z","iopub.status.busy":"2023-10-24T07:56:55.852815Z","iopub.status.idle":"2023-10-24T07:56:55.855988Z","shell.execute_reply":"2023-10-24T07:56:55.855581Z"},"papermill":{"duration":0.026763,"end_time":"2023-10-24T07:56:55.856936","exception":false,"start_time":"2023-10-24T07:56:55.830173","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"xcube_sh.__version__","visibility":"show","key":"KfhrLeikGE"},{"type":"output","id":"tXXoA4mMkbYunJ6RZySIJ","data":[{"output_type":"execute_result","execution_count":5,"metadata":{},"data":{"text/plain":{"content":"'0.10.3'","content_type":"text/plain"}}}],"visibility":"show","key":"E04uuHw2Bs"}],"visibility":"show","key":"glm0iaqGqf"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-10-24T07:56:55.919210Z","iopub.status.busy":"2023-10-24T07:56:55.918852Z","iopub.status.idle":"2023-10-24T07:56:55.922197Z","shell.execute_reply":"2023-10-24T07:56:55.921697Z"},"papermill":{"duration":0.027004,"end_time":"2023-10-24T07:56:55.923610","exception":false,"start_time":"2023-10-24T07:56:55.896606","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"xcube.__version__\n","visibility":"show","key":"DSK8VAHijH"},{"type":"output","id":"wF0-kk3iTbz7D15oI99o_","data":[{"output_type":"execute_result","execution_count":6,"metadata":{},"data":{"text/plain":{"content":"'1.2.0'","content_type":"text/plain"}}}],"visibility":"show","key":"ZXRvAvdXbu"}],"visibility":"show","key":"vHvrpH3Cqk"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.023709,"end_time":"2023-10-24T07:56:55.990449","exception":false,"start_time":"2023-10-24T07:56:55.966740","status":"completed"},"tags":[]},"children":[{"type":"thematicBreak","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"BiwKxtyoFw"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"For this demo, we are focussing on small coastal area near Kiel in Northern Germany (Baltic Sea)","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"uk2PRSJRZE"}],"key":"a4YhPqDFP0"}],"visibility":"show","key":"EJzxJTjEyw"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-10-24T07:56:56.047868Z","iopub.status.busy":"2023-10-24T07:56:56.047546Z","iopub.status.idle":"2023-10-24T07:56:56.050375Z","shell.execute_reply":"2023-10-24T07:56:56.049980Z"},"papermill":{"duration":0.02704,"end_time":"2023-10-24T07:56:56.051459","exception":false,"start_time":"2023-10-24T07:56:56.024419","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"x1 = 10.00  # degree\ny1 = 54.27  # degree\nx2 = 11.00  # degree\ny2 = 54.60  # degree\n\nbbox = x1, y1, x2, y2","visibility":"show","key":"VQXIR0Cmj2"},{"type":"output","id":"aoI-m8KoIzY9eYyKLrvfP","data":[],"visibility":"show","key":"xgWh70kAIz"}],"visibility":"show","key":"jdw97nr43r"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.022273,"end_time":"2023-10-24T07:56:56.109848","exception":false,"start_time":"2023-10-24T07:56:56.087575","status":"completed"},"tags":[]},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Visualize the bounding box. If you don’t see anything, please refer to EDC Setup example ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ggj56CFlhj"},{"type":"link","url":"https://eurodatacube.com/marketplace/notebooks/curated/EDC_Sentinel_Hub-Setup","children":[{"type":"text","value":"here","key":"Hckq6Jw8Sv"}],"urlSource":"https://eurodatacube.com/marketplace/notebooks/curated/EDC_Sentinel_Hub-Setup","key":"vT5fpRNgZH"},{"type":"text","value":".","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"aj3hp1Aduw"}],"key":"StOjHIKMmc"}],"visibility":"show","key":"ABPa8D6hZN"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-10-24T07:56:56.170691Z","iopub.status.busy":"2023-10-24T07:56:56.170152Z","iopub.status.idle":"2023-10-24T07:56:56.174580Z","shell.execute_reply":"2023-10-24T07:56:56.174139Z"},"papermill":{"duration":0.028538,"end_time":"2023-10-24T07:56:56.175566","exception":false,"start_time":"2023-10-24T07:56:56.147028","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"IPython.display.GeoJSON(shapely.geometry.box(*bbox).__geo_interface__)","visibility":"show","key":"jSwedx6ruL"},{"type":"output","id":"sBaLOjDH7uMYAKsrtGkRK","data":[{"output_type":"display_data","metadata":{"application/geo+json":{"expanded":false,"root":"root"}},"data":{"application/geo+json":{"content":"{\"coordinates\":[[[11,54.27],[11,54.6],[10,54.6],[10,54.27],[11,54.27]]],\"type\":\"Polygon\"}","content_type":"application/geo+json"},"text/plain":{"content":"<IPython.display.GeoJSON object>","content_type":"text/plain"}}}],"visibility":"show","key":"fqNf6oaWgE"}],"visibility":"show","key":"mPIYEOx1UL"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.023517,"end_time":"2023-10-24T07:56:56.238183","exception":false,"start_time":"2023-10-24T07:56:56.214666","status":"completed"},"tags":[]},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Later in this NB we are going to compute some indexes from bands atmospherically corrected bands B04, B05, B06, B11 of Sentinel-2 (S2L2A)\nOur time range covers two and a half month of last year’s summer: 2018-05-14 to 2018-07-31","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"AbzrCC4XOW"}],"key":"vAbpxQo2UY"},{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"The desired resolution is roughly 20 meters per pixel:","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"A36zNJKZjM"}],"key":"vIkYcD4Ecf"}],"visibility":"show","key":"PFwncv0ILY"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-10-24T07:56:56.299657Z","iopub.status.busy":"2023-10-24T07:56:56.299389Z","iopub.status.idle":"2023-10-24T07:56:56.302409Z","shell.execute_reply":"2023-10-24T07:56:56.301901Z"},"papermill":{"duration":0.028111,"end_time":"2023-10-24T07:56:56.303455","exception":false,"start_time":"2023-10-24T07:56:56.275344","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"spatial_res = 0.00018   # = 20.038 meters in degree>","visibility":"show","key":"jWiehyrorj"},{"type":"output","id":"ASw1v76czWbRcuEKAXcCQ","data":[],"visibility":"show","key":"JecSdYDHPJ"}],"visibility":"show","key":"rA4ztovO8E"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.022139,"end_time":"2023-10-24T07:56:56.370002","exception":false,"start_time":"2023-10-24T07:56:56.347863","status":"completed"},"tags":[]},"children":[{"type":"thematicBreak","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"xcmdjVBTHF"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Example (!): Sentinel-2 L2A with aggregated observations that fall into equal-size ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"TLvGI8QO5A"},{"type":"inlineCode","value":"time_period","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"la2esAbQLP"},{"type":"text","value":" of 2 days:","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"qY4rkVWXC8"}],"key":"vAue0pYiyN"}],"visibility":"show","key":"TvTpBjWuu1"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-10-24T07:56:56.430873Z","iopub.status.busy":"2023-10-24T07:56:56.430511Z","iopub.status.idle":"2023-10-24T07:56:56.434148Z","shell.execute_reply":"2023-10-24T07:56:56.433629Z"},"papermill":{"duration":0.028129,"end_time":"2023-10-24T07:56:56.435157","exception":false,"start_time":"2023-10-24T07:56:56.407028","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"cube_config = CubeConfig(dataset_name='S2L2A',\n                         band_names=['B04', 'B05', 'B06', 'B11', 'SCL', 'CLD'],\n                         tile_size=[512, 512],\n                         bbox=bbox,\n                         spatial_res=spatial_res,\n                         time_range=['2018-05-14', '2018-07-31'],\n                         time_period='2D')","visibility":"show","key":"sybLmjorak"},{"type":"output","id":"LzzP46Y3Bg0wdklhj1rtj","data":[],"visibility":"show","key":"puLwlFtCqN"}],"visibility":"show","key":"lCAs10sA6v"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.023957,"end_time":"2023-10-24T07:56:56.500360","exception":false,"start_time":"2023-10-24T07:56:56.476403","status":"completed"},"tags":[]},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"We define a ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"CuI3NmBFbd"},{"type":"inlineCode","value":"request_collector","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"VNZ7zbZK70"},{"type":"text","value":" as an observer for SH requests made, so we can show SH usage stats. This is a developer tool, useful for demonstration purposes too. ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"X6z6gLCVtl"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Otherwise, this is not needed.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"kdWdrxnz4G"}],"key":"Qb0WTVGRbt"}],"key":"KT1QmL75US"}],"visibility":"show","key":"bZOYEyNgHq"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-10-24T07:56:56.563768Z","iopub.status.busy":"2023-10-24T07:56:56.563324Z","iopub.status.idle":"2023-10-24T07:56:56.566188Z","shell.execute_reply":"2023-10-24T07:56:56.565746Z"},"papermill":{"duration":0.028468,"end_time":"2023-10-24T07:56:56.567342","exception":false,"start_time":"2023-10-24T07:56:56.538874","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"request_collector = Observers.request_collector()","visibility":"show","key":"Am3ILicGDW"},{"type":"output","id":"XUcilKD_jFGLLwGaXxwjw","data":[],"visibility":"show","key":"oioXKDr6xo"}],"visibility":"show","key":"EET0MQHqKD"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.021392,"end_time":"2023-10-24T07:56:56.627506","exception":false,"start_time":"2023-10-24T07:56:56.606114","status":"completed"},"tags":[]},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Open a data cube:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"WUUrNBejUk"}],"key":"HSaTaloxqU"}],"visibility":"show","key":"ZWLUSh8J6V"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-10-24T07:56:56.683682Z","iopub.status.busy":"2023-10-24T07:56:56.683334Z","iopub.status.idle":"2023-10-24T07:56:56.798048Z","shell.execute_reply":"2023-10-24T07:56:56.797579Z"},"papermill":{"duration":0.138483,"end_time":"2023-10-24T07:56:56.799438","exception":false,"start_time":"2023-10-24T07:56:56.660955","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"cube = open_cube(cube_config, observer=request_collector)","visibility":"show","key":"W0SKNHXJy4"},{"type":"output","id":"I_aFRCQkvY0DhDLfUsMb-","data":[],"visibility":"show","key":"y91XjQrgBf"}],"visibility":"show","key":"EfEeTbJyPV"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-10-24T07:56:56.861216Z","iopub.status.busy":"2023-10-24T07:56:56.860911Z","iopub.status.idle":"2023-10-24T07:56:56.907952Z","shell.execute_reply":"2023-10-24T07:56:56.907413Z"},"papermill":{"duration":0.072291,"end_time":"2023-10-24T07:56:56.909531","exception":false,"start_time":"2023-10-24T07:56:56.837240","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"cube","visibility":"show","key":"KitxpU7d6K"},{"type":"output","id":"aQsVfUxKbksHJqipkIU3c","data":[{"output_type":"execute_result","execution_count":13,"metadata":{},"data":{"text/html":{"content_type":"text/html","hash":"ebd632ad677f03a6086d140837bdf5e8","path":"/example-viewer/build/ebd632ad677f03a6086d140837bdf5e8.html"},"text/plain":{"content":"<xarray.Dataset>\nDimensions:    (time: 40, lat: 2048, lon: 5632, bnds: 2)\nCoordinates:\n  * lat        (lat) float64 54.64 54.64 54.64 54.64 ... 54.27 54.27 54.27 54.27\n  * lon        (lon) float64 10.0 10.0 10.0 10.0 ... 11.01 11.01 11.01 11.01\n  * time       (time) datetime64[ns] 2018-05-15 2018-05-17 ... 2018-08-01\n    time_bnds  (time, bnds) datetime64[ns] dask.array<chunksize=(40, 2), meta=np.ndarray>\nDimensions without coordinates: bnds\nData variables:\n    B04        (time, lat, lon) float32 dask.array<chunksize=(1, 512, 512), meta=np.ndarray>\n    B05        (time, lat, lon) float32 dask.array<chunksize=(1, 512, 512), meta=np.ndarray>\n    B06        (time, lat, lon) float32 dask.array<chunksize=(1, 512, 512), meta=np.ndarray>\n    B11        (time, lat, lon) float32 dask.array<chunksize=(1, 512, 512), meta=np.ndarray>\n    CLD        (time, lat, lon) uint8 dask.array<chunksize=(1, 512, 512), meta=np.ndarray>\n    SCL        (time, lat, lon) uint8 dask.array<chunksize=(1, 512, 512), meta=np.ndarray>\nAttributes: (12/13)\n    Conventions:               CF-1.7\n    title:                     S2L2A Data Cube Subset\n    history:                   [{'program': 'xcube_sh.chunkstore.SentinelHubC...\n    date_created:              2023-10-24T07:56:56.738465\n    time_coverage_start:       2018-05-14T00:00:00+00:00\n    time_coverage_end:         2018-08-02T00:00:00+00:00\n    ...                        ...\n    time_coverage_resolution:  P2DT0H0M0S\n    geospatial_lon_min:        10.0\n    geospatial_lat_min:        54.27\n    geospatial_lon_max:        11.01376\n    geospatial_lat_max:        54.63864\n    processing_level:          L2A","content_type":"text/plain"}}}],"visibility":"show","key":"cJi8GIsjrl"}],"visibility":"show","key":"V4qApkocEU"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.038799,"end_time":"2023-10-24T07:56:56.995361","exception":false,"start_time":"2023-10-24T07:56:56.956562","status":"completed"},"tags":[]},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"No requests have been made yet. Requests are made only if data is actually required.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"tuCGIN64WO"}],"key":"ALAtIpdsgD"}],"visibility":"show","key":"S7OnJ99Owl"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-10-24T07:56:57.089505Z","iopub.status.busy":"2023-10-24T07:56:57.089132Z","iopub.status.idle":"2023-10-24T07:56:57.092721Z","shell.execute_reply":"2023-10-24T07:56:57.092282Z"},"papermill":{"duration":0.04259,"end_time":"2023-10-24T07:56:57.093817","exception":false,"start_time":"2023-10-24T07:56:57.051227","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"request_collector.stats","visibility":"show","key":"k1yvH7AhcU"},{"type":"output","id":"myXXw5OC2UMo3RCQl9fPI","data":[{"output_type":"execute_result","execution_count":14,"metadata":{},"data":{"text/html":{"content":"<html><p>No requests made yet.</p></html>","content_type":"text/html"},"text/plain":{"content":"<xcube_sh.observers._RequestStats at 0x7f4ea6d6add0>","content_type":"text/plain"}}}],"visibility":"show","key":"z9OEomufMS"}],"visibility":"show","key":"KuXkmgYYvS"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.034862,"end_time":"2023-10-24T07:56:57.176334","exception":false,"start_time":"2023-10-24T07:56:57.141472","status":"completed"},"tags":[]},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Note, the cube’s time coordinates are monotonically increasing and the distance between two time steps is varying:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"uEbQNgxL2r"}],"key":"RY9sDHhgOE"}],"visibility":"show","key":"eMxquHkL2U"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-10-24T07:56:57.261984Z","iopub.status.busy":"2023-10-24T07:56:57.261641Z","iopub.status.idle":"2023-10-24T07:56:57.481506Z","shell.execute_reply":"2023-10-24T07:56:57.481094Z"},"papermill":{"duration":0.255317,"end_time":"2023-10-24T07:56:57.482766","exception":false,"start_time":"2023-10-24T07:56:57.227449","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"cube.time.diff(dim='time').plot.line()","visibility":"show","key":"Kgl7bUvFB5"},{"type":"output","id":"QzSxIGyYhb0JHGnjH61So","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"ee85cf78f7613d4971a4a38073e5c638","path":"/example-viewer/build/ee85cf78f7613d4971a4a38073e5c638.png"},"text/plain":{"content":"<Figure size 640x480 with 1 Axes>","content_type":"text/plain"}}}],"visibility":"show","key":"mcne0Sivcl"}],"visibility":"show","key":"J4zJkZgSXy"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-10-24T07:56:57.586788Z","iopub.status.busy":"2023-10-24T07:56:57.586556Z","iopub.status.idle":"2023-10-24T07:56:57.598349Z","shell.execute_reply":"2023-10-24T07:56:57.597938Z"},"papermill":{"duration":0.057716,"end_time":"2023-10-24T07:56:57.599411","exception":false,"start_time":"2023-10-24T07:56:57.541695","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"cube.B04","visibility":"show","key":"keQiXcDx2n"},{"type":"output","id":"CLU7ZMcEm2k_h5FEzNQ91","data":[{"output_type":"execute_result","execution_count":16,"metadata":{},"data":{"text/html":{"content_type":"text/html","hash":"1ff61dd380e434c9c7d82d731b7148d9","path":"/example-viewer/build/1ff61dd380e434c9c7d82d731b7148d9.html"},"text/plain":{"content":"<xarray.DataArray 'B04' (time: 40, lat: 2048, lon: 5632)>\ndask.array<open_dataset-B04, shape=(40, 2048, 5632), dtype=float32, chunksize=(1, 512, 512), chunktype=numpy.ndarray>\nCoordinates:\n  * lat      (lat) float64 54.64 54.64 54.64 54.64 ... 54.27 54.27 54.27 54.27\n  * lon      (lon) float64 10.0 10.0 10.0 10.0 10.0 ... 11.01 11.01 11.01 11.01\n  * time     (time) datetime64[ns] 2018-05-15 2018-05-17 ... 2018-08-01\nAttributes:\n    sample_type:   FLOAT32\n    units:         reflectance\n    wavelength:    664.75\n    wavelength_a:  664.6\n    wavelength_b:  664.9\n    bandwidth:     31.0\n    bandwidth_a:   31\n    bandwidth_b:   31\n    resolution:    10","content_type":"text/plain"}}}],"visibility":"show","key":"pL1Ez8xATu"}],"visibility":"show","key":"BV9VLjta8C"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-10-24T07:56:57.692625Z","iopub.status.busy":"2023-10-24T07:56:57.692392Z","iopub.status.idle":"2023-10-24T07:57:22.347894Z","shell.execute_reply":"2023-10-24T07:57:22.347359Z"},"papermill":{"duration":24.70033,"end_time":"2023-10-24T07:57:22.353476","exception":false,"start_time":"2023-10-24T07:56:57.653146","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"cube.B04.sel(time='2018-05-21 10:00:00', method='nearest').plot.imshow(vmin=0, vmax=0.2, cmap='Greys_r', figsize=(16, 10))","visibility":"show","key":"WYfKZOQwXM"},{"type":"output","id":"aNR_tMPxoMhhZ1qkt4nL3","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"6bee24e8ff107f27dbd7c22e54bb75e9","path":"/example-viewer/build/6bee24e8ff107f27dbd7c22e54bb75e9.png"},"text/plain":{"content":"<Figure size 1600x1000 with 2 Axes>","content_type":"text/plain"}}}],"visibility":"show","key":"QPKMo2l8pK"}],"visibility":"show","key":"hw7730nQmQ"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.087354,"end_time":"2023-10-24T07:57:22.535913","exception":false,"start_time":"2023-10-24T07:57:22.448559","status":"completed"},"tags":[]},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Now SentinelHub data requests have been made","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"sm1XWkRx4w"}],"key":"B09zA1FGB3"}],"visibility":"show","key":"JW4mQwlvwQ"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-10-24T07:57:22.702715Z","iopub.status.busy":"2023-10-24T07:57:22.702455Z","iopub.status.idle":"2023-10-24T07:57:22.706558Z","shell.execute_reply":"2023-10-24T07:57:22.706034Z"},"papermill":{"duration":0.077549,"end_time":"2023-10-24T07:57:22.707798","exception":false,"start_time":"2023-10-24T07:57:22.630249","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"request_collector.stats","visibility":"show","key":"I6FSb9yvqG"},{"type":"output","id":"Tj76PwtZTe_Ni6rOGuwvE","data":[{"output_type":"execute_result","execution_count":18,"metadata":{},"data":{"text/html":{"content":"<html><table><tr><td>Number of requests:</td><td>44</td></tr><tr><td>Request duration min:</td><td>292.09 ms</td></tr><tr><td>Request duration max:</td><td>1217.71 ms</td></tr><tr><td>Request duration median:</td><td>496.19 ms</td></tr><tr><td>Request duration mean:</td><td>533.67 ms</td></tr><tr><td>Request duration std:</td><td>198.43 ms</td></tr></table></html>","content_type":"text/html"},"text/plain":{"content":"<xcube_sh.observers._RequestStats at 0x7f4ea5894a50>","content_type":"text/plain"}}}],"visibility":"show","key":"jqitAyANbo"}],"visibility":"show","key":"a7T6wDuGKG"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.067226,"end_time":"2023-10-24T07:57:22.868733","exception":false,"start_time":"2023-10-24T07:57:22.801507","status":"completed"},"tags":[]},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"xcube mask sets also follow data cube structure","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"eBRETRBSI0"}],"key":"CLzwSZyhcs"}],"visibility":"show","key":"bYBPW68zZl"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.06896,"end_time":"2023-10-24T07:57:23.025000","exception":false,"start_time":"2023-10-24T07:57:22.956040","status":"completed"},"tags":[]},"children":[{"type":"thematicBreak","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"nZutB3s3ji"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Example (2): Sentinel-2 L2A which only includes time stamps where there were valid observations for a given region. We use a ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"nj48zJSFq2"},{"type":"inlineCode","value":"time_tolerance","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"kRFSjFw9dO"},{"type":"text","value":" of 30 minutes to decide whether scenes shall be combined:","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"i2j8PlDQzs"}],"key":"mb715qMrbF"}],"visibility":"show","key":"gLC51G9hxD"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-10-24T07:57:23.176805Z","iopub.status.busy":"2023-10-24T07:57:23.176569Z","iopub.status.idle":"2023-10-24T07:57:23.180883Z","shell.execute_reply":"2023-10-24T07:57:23.180369Z"},"papermill":{"duration":0.074988,"end_time":"2023-10-24T07:57:23.182090","exception":false,"start_time":"2023-10-24T07:57:23.107102","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"cube_config = CubeConfig(dataset_name='S2L2A',\n                         band_names=['B04', 'B05', 'B06', 'B11', 'SCL', 'CLD'],\n                         tile_size=[512, 512],\n                         bbox=bbox,\n                         spatial_res=spatial_res,\n                         time_range=['2018-05-14', '2018-07-31'],                         \n                         time_tolerance='30M')","visibility":"show","key":"O6w7qa7M2I"},{"type":"output","id":"q-lLIZBGz-s-o5jSNITZX","data":[{"name":"stderr","output_type":"stream","text":"/home/conda/20a41cef-8d63-4030-9e37-aa3412866cee/60a7fe77bf15cdba38ca795208c44847e274649eaaa525aeefa5bf7a3f7692e0-20231023-081922-894744-312-bm-test-edc-2023.10-01/lib/python3.11/site-packages/xcube_sh/config.py:248: FutureWarning: Units 'M', 'Y' and 'y' do not represent unambiguous timedelta values and will be removed in a future version.\n  time_tolerance = pd.to_timedelta(time_tolerance)\n"}],"visibility":"show","key":"oiLlSejaLc"}],"visibility":"show","key":"llmLx3Fb9b"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-10-24T07:57:23.343154Z","iopub.status.busy":"2023-10-24T07:57:23.342826Z","iopub.status.idle":"2023-10-24T07:57:23.502606Z","shell.execute_reply":"2023-10-24T07:57:23.502150Z"},"papermill":{"duration":0.228859,"end_time":"2023-10-24T07:57:23.504112","exception":false,"start_time":"2023-10-24T07:57:23.275253","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"cube = open_cube(cube_config)\ncube","visibility":"show","key":"MVkBj67TuL"},{"type":"output","id":"4RXPO-90e4865eMDIDGF2","data":[{"output_type":"execute_result","execution_count":20,"metadata":{},"data":{"text/html":{"content_type":"text/html","hash":"009980e53b1efa21e5c49732400fb3c0","path":"/example-viewer/build/009980e53b1efa21e5c49732400fb3c0.html"},"text/plain":{"content":"<xarray.Dataset>\nDimensions:    (time: 45, lat: 2048, lon: 5632, bnds: 2)\nCoordinates:\n  * lat        (lat) float64 54.64 54.64 54.64 54.64 ... 54.27 54.27 54.27 54.27\n  * lon        (lon) float64 10.0 10.0 10.0 10.0 ... 11.01 11.01 11.01 11.01\n  * time       (time) datetime64[ns] 2018-05-15T10:30:24 ... 2018-07-29T10:30:19\n    time_bnds  (time, bnds) datetime64[ns] dask.array<chunksize=(45, 2), meta=np.ndarray>\nDimensions without coordinates: bnds\nData variables:\n    B04        (time, lat, lon) float32 dask.array<chunksize=(1, 512, 512), meta=np.ndarray>\n    B05        (time, lat, lon) float32 dask.array<chunksize=(1, 512, 512), meta=np.ndarray>\n    B06        (time, lat, lon) float32 dask.array<chunksize=(1, 512, 512), meta=np.ndarray>\n    B11        (time, lat, lon) float32 dask.array<chunksize=(1, 512, 512), meta=np.ndarray>\n    CLD        (time, lat, lon) uint8 dask.array<chunksize=(1, 512, 512), meta=np.ndarray>\n    SCL        (time, lat, lon) uint8 dask.array<chunksize=(1, 512, 512), meta=np.ndarray>\nAttributes:\n    Conventions:             CF-1.7\n    title:                   S2L2A Data Cube Subset\n    history:                 [{'program': 'xcube_sh.chunkstore.SentinelHubChu...\n    date_created:            2023-10-24T07:57:23.455762\n    time_coverage_start:     2018-05-15T10:30:24+00:00\n    time_coverage_end:       2018-07-29T10:30:19+00:00\n    time_coverage_duration:  P74DT23H59M55S\n    geospatial_lon_min:      10.0\n    geospatial_lat_min:      54.27\n    geospatial_lon_max:      11.01376\n    geospatial_lat_max:      54.63864\n    processing_level:        L2A","content_type":"text/plain"}}}],"visibility":"show","key":"GKXI6I1qQa"}],"visibility":"show","key":"s3KbphXx8z"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-10-24T07:57:23.670679Z","iopub.status.busy":"2023-10-24T07:57:23.670399Z","iopub.status.idle":"2023-10-24T07:57:23.894891Z","shell.execute_reply":"2023-10-24T07:57:23.894471Z"},"papermill":{"duration":0.304691,"end_time":"2023-10-24T07:57:23.896898","exception":false,"start_time":"2023-10-24T07:57:23.592207","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"cube.time.diff(dim='time').plot.line()","visibility":"show","key":"nOoPSYa7iC"},{"type":"output","id":"BM7uaP3kS98mSK8CnQ3b1","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"348c029e84a842d673d77c5efa9c26cc","path":"/example-viewer/build/348c029e84a842d673d77c5efa9c26cc.png"},"text/plain":{"content":"<Figure size 640x480 with 1 Axes>","content_type":"text/plain"}}}],"visibility":"show","key":"eXfyvqZZ2c"}],"visibility":"show","key":"yfmIm2TGpg"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.072416,"end_time":"2023-10-24T07:57:24.076982","exception":false,"start_time":"2023-10-24T07:57:24.004566","status":"completed"},"tags":[]},"children":[{"type":"thematicBreak","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"J2ytdZUKpa"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Example (3): Using projected coordinates, setting the ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"FHY7jIpOGg"},{"type":"inlineCode","value":"crs","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"CjjK2QBRDM"},{"type":"text","value":" parameter to ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"RPKvgXS0gl"},{"type":"inlineCode","value":"'http://www.opengis.net/def/crs/EPSG/0/3857'","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"hCl1RaWmEH"},{"type":"text","value":" (EPSG:3857), that is Pseude-Mercato using a WGS-84 Ellisoid. Note that the spatial coordinates now switched from ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"gbcwsRJJGC"},{"type":"inlineCode","value":"lon","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"ULabQQEWuy"},{"type":"text","value":", ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"grS96Tzsy5"},{"type":"inlineCode","value":"lat","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"sVTPIXnvSU"},{"type":"text","value":" to ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"oG28rqWedg"},{"type":"inlineCode","value":"x","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"ok9KiL1fH5"},{"type":"text","value":", ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"C4kjlRfW6u"},{"type":"inlineCode","value":"y","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"NeuoFefU8V"},{"type":"text","value":". For other CRSes, refer to ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"gLF4WQml94"},{"type":"link","url":"https://docs.sentinel-hub.com/api/latest/#/API/crs","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"https://​docs​.sentinel​-hub​.com​/api​/latest​/​#​/API​/crs","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"W3czmRkFZw"}],"urlSource":"https://docs.sentinel-hub.com/api/latest/#/API/crs","key":"KnmHhpCxHv"},{"type":"text","value":".","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"oRBX42TkMl"}],"key":"bylQselOBl"},{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"We need to provide the ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"CSkG4op5Vz"},{"type":"inlineCode","value":"bbox","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"GlbSml4A12"},{"type":"text","value":" and ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"CRPx3QZcJt"},{"type":"inlineCode","value":"spatial_res","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"vNpExHQZI9"},{"type":"text","value":" parameters in EPSG:3857 units (meters) now, Ljubljana area:","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"EHk6XZ2r2v"}],"key":"O5YNrLTVVw"}],"visibility":"show","key":"tfF7RZLNsT"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-10-24T07:57:24.248009Z","iopub.status.busy":"2023-10-24T07:57:24.247545Z","iopub.status.idle":"2023-10-24T07:57:24.250799Z","shell.execute_reply":"2023-10-24T07:57:24.250338Z"},"papermill":{"duration":0.076164,"end_time":"2023-10-24T07:57:24.252036","exception":false,"start_time":"2023-10-24T07:57:24.175872","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"x1 = 1545577  # meters\ny1 = 5761986  # meters\nx2 = 1705367  # meters\ny2 = 5857046  # meters\n\nbbox = x1, y1, x2, y2\n\nspatial_res = (x2 - x1) / 512  # meters","visibility":"show","key":"R7nI5RHRkt"},{"type":"output","id":"Nlw2nrq84nbz8qbte1MzB","data":[],"visibility":"show","key":"YucaFlFCHo"}],"visibility":"show","key":"dyXg5tqEFk"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.072877,"end_time":"2023-10-24T07:57:24.423088","exception":false,"start_time":"2023-10-24T07:57:24.350211","status":"completed"},"tags":[]},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Verify we are right:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"nNKpfEnuTP"}],"key":"qdRzc2pONl"}],"visibility":"show","key":"aormT5wVDk"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-10-24T07:57:24.591019Z","iopub.status.busy":"2023-10-24T07:57:24.590776Z","iopub.status.idle":"2023-10-24T07:57:24.609205Z","shell.execute_reply":"2023-10-24T07:57:24.608753Z"},"papermill":{"duration":0.093025,"end_time":"2023-10-24T07:57:24.610187","exception":false,"start_time":"2023-10-24T07:57:24.517162","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"geom = shapely.geometry.box(*bbox)\n\nimport functools\nimport pyproj\nimport shapely.ops\n\nproject = functools.partial(\n    pyproj.transform,\n    pyproj.Proj(init='epsg:3857'),  # source coordinate system (Web Mercator)\n    pyproj.Proj(init='epsg:4326'))  # destination coordinate system (WGS-84)\n\ngeom_wgs84 = shapely.ops.transform(project, geom)  # apply projection\nIPython.display.GeoJSON(geom_wgs84.__geo_interface__)","visibility":"show","key":"vQcoojwg1Z"},{"type":"output","id":"Jb6qq6ekI4T1uWVgWBNQk","data":[{"name":"stderr","output_type":"stream","text":"/home/conda/20a41cef-8d63-4030-9e37-aa3412866cee/60a7fe77bf15cdba38ca795208c44847e274649eaaa525aeefa5bf7a3f7692e0-20231023-081922-894744-312-bm-test-edc-2023.10-01/lib/python3.11/site-packages/pyproj/crs/crs.py:141: FutureWarning: '+init=<authority>:<code>' syntax is deprecated. '<authority>:<code>' is the preferred initialization method. When making the change, be mindful of axis order changes: https://pyproj4.github.io/pyproj/stable/gotchas.html#axis-order-changes-in-proj-6\n  in_crs_string = _prepare_from_proj_string(in_crs_string)\n/home/conda/20a41cef-8d63-4030-9e37-aa3412866cee/60a7fe77bf15cdba38ca795208c44847e274649eaaa525aeefa5bf7a3f7692e0-20231023-081922-894744-312-bm-test-edc-2023.10-01/lib/python3.11/site-packages/pyproj/crs/crs.py:141: FutureWarning: '+init=<authority>:<code>' syntax is deprecated. '<authority>:<code>' is the preferred initialization method. When making the change, be mindful of axis order changes: https://pyproj4.github.io/pyproj/stable/gotchas.html#axis-order-changes-in-proj-6\n  in_crs_string = _prepare_from_proj_string(in_crs_string)\n/home/conda/20a41cef-8d63-4030-9e37-aa3412866cee/60a7fe77bf15cdba38ca795208c44847e274649eaaa525aeefa5bf7a3f7692e0-20231023-081922-894744-312-bm-test-edc-2023.10-01/lib/python3.11/site-packages/shapely/ops.py:276: FutureWarning: This function is deprecated. See: https://pyproj4.github.io/pyproj/stable/gotchas.html#upgrading-to-pyproj-2-from-pyproj-1\n  shell = type(geom.exterior)(zip(*func(*zip(*geom.exterior.coords))))\n"},{"output_type":"display_data","metadata":{"application/geo+json":{"expanded":false,"root":"root"}},"data":{"application/geo+json":{"content":"{\"coordinates\":[[[15.31957241133056,45.88529075682661],[15.31957241133056,46.4765354334654],[13.884154418835974,46.4765354334654],[13.884154418835974,45.88529075682661],[15.31957241133056,45.88529075682661]]],\"type\":\"Polygon\"}","content_type":"application/geo+json"},"text/plain":{"content":"<IPython.display.GeoJSON object>","content_type":"text/plain"}}}],"visibility":"show","key":"rkowdVX72U"}],"visibility":"show","key":"RhsFY4psdb"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-10-24T07:57:24.778137Z","iopub.status.busy":"2023-10-24T07:57:24.777877Z","iopub.status.idle":"2023-10-24T07:57:24.781414Z","shell.execute_reply":"2023-10-24T07:57:24.780996Z"},"papermill":{"duration":0.08365,"end_time":"2023-10-24T07:57:24.782496","exception":false,"start_time":"2023-10-24T07:57:24.698846","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"cube_config = CubeConfig(dataset_name='S2L2A',\n                         band_names=['B04', 'B05', 'B06', 'B11', 'SCL', 'CLD'],\n                         tile_size=[512, 512],\n                         crs='http://www.opengis.net/def/crs/EPSG/0/3857',\n                         bbox=bbox,\n                         spatial_res=spatial_res,\n                         time_range=['2018-05-01', '2018-05-10'],                         \n                         time_period='1D')","visibility":"show","key":"cOlk4EpLNx"},{"type":"output","id":"9eipI3VnB0sdFFlkn_Ig6","data":[],"visibility":"show","key":"kCCYwl1MlT"}],"visibility":"show","key":"fuub8WUAl3"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-10-24T07:57:24.948699Z","iopub.status.busy":"2023-10-24T07:57:24.948442Z","iopub.status.idle":"2023-10-24T07:57:25.032035Z","shell.execute_reply":"2023-10-24T07:57:25.031423Z"},"papermill":{"duration":0.156465,"end_time":"2023-10-24T07:57:25.033503","exception":false,"start_time":"2023-10-24T07:57:24.877038","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"cube = open_cube(cube_config)\ncube","visibility":"show","key":"TFBr7TK4Ak"},{"type":"output","id":"M0dI4CLkyyOcsK7MNpOxX","data":[{"output_type":"execute_result","execution_count":25,"metadata":{},"data":{"text/html":{"content_type":"text/html","hash":"e15bd349a882e113b36cde49f304bd69","path":"/example-viewer/build/e15bd349a882e113b36cde49f304bd69.html"},"text/plain":{"content":"<xarray.Dataset>\nDimensions:    (time: 10, y: 305, x: 512, bnds: 2)\nCoordinates:\n  * time       (time) datetime64[ns] 2018-05-01T12:00:00 ... 2018-05-10T12:00:00\n    time_bnds  (time, bnds) datetime64[ns] dask.array<chunksize=(10, 2), meta=np.ndarray>\n  * x          (x) float64 1.546e+06 1.546e+06 1.546e+06 ... 1.705e+06 1.705e+06\n  * y          (y) float64 5.857e+06 5.857e+06 5.856e+06 ... 5.762e+06 5.762e+06\nDimensions without coordinates: bnds\nData variables:\n    B04        (time, y, x) float32 dask.array<chunksize=(1, 305, 512), meta=np.ndarray>\n    B05        (time, y, x) float32 dask.array<chunksize=(1, 305, 512), meta=np.ndarray>\n    B06        (time, y, x) float32 dask.array<chunksize=(1, 305, 512), meta=np.ndarray>\n    B11        (time, y, x) float32 dask.array<chunksize=(1, 305, 512), meta=np.ndarray>\n    CLD        (time, y, x) uint8 dask.array<chunksize=(1, 305, 512), meta=np.ndarray>\n    SCL        (time, y, x) uint8 dask.array<chunksize=(1, 305, 512), meta=np.ndarray>\n    crs        int64 ...\nAttributes:\n    Conventions:               CF-1.7\n    title:                     S2L2A Data Cube Subset\n    history:                   [{'program': 'xcube_sh.chunkstore.SentinelHubC...\n    date_created:              2023-10-24T07:57:25.000248\n    time_coverage_start:       2018-05-01T00:00:00+00:00\n    time_coverage_end:         2018-05-11T00:00:00+00:00\n    time_coverage_duration:    P10DT0H0M0S\n    time_coverage_resolution:  P1DT0H0M0S\n    processing_level:          L2A","content_type":"text/plain"}}}],"visibility":"show","key":"a2EFrynTNM"}],"visibility":"show","key":"d5gZWzoCAF"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-10-24T07:57:25.206909Z","iopub.status.busy":"2023-10-24T07:57:25.206501Z","iopub.status.idle":"2023-10-24T07:57:26.326981Z","shell.execute_reply":"2023-10-24T07:57:26.326300Z"},"papermill":{"duration":1.205709,"end_time":"2023-10-24T07:57:26.329414","exception":false,"start_time":"2023-10-24T07:57:25.123705","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"cube.B04.isel(time=5).plot.imshow(vmin=0, vmax=0.18, cmap='Greys_r', figsize=(16, 10))","visibility":"show","key":"pQQGGBQP8B"},{"type":"output","id":"VFDnVzyi4qXTgJOoX5uI4","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"cb07bd73a0b60bf37072235984130819","path":"/example-viewer/build/cb07bd73a0b60bf37072235984130819.png"},"text/plain":{"content":"<Figure size 1600x1000 with 2 Axes>","content_type":"text/plain"}}}],"visibility":"show","key":"NejIyi6K1k"}],"visibility":"show","key":"fDwXrKwMXB"}],"key":"nYU78JCl75"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"[xcube-geodb] How to accesss EEA Urban Atlas Data","url":"/external-notebooks/eurodatacube/notebooks/notebooks/curated/edc-geodb-access-urban-atlas-data-v1","group":"Curated"},"next":{"title":"EDC Sentinel Hub: Data Fusion","url":"/external-notebooks/eurodatacube/notebooks/notebooks/curated/edc-sentinelhub-datafusion-basic","group":"Curated"}}},"domain":"http://localhost:3000"}